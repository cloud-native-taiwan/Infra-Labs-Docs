"use strict";(self.webpackChunknew_infra_labs_docs=self.webpackChunknew_infra_labs_docs||[]).push([[6003],{1927:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"self-paced-labs/vault/index","title":"Quarkus \u6574\u5408 Vault KV \u5f15\u64ce","description":"","source":"@site/docs/self-paced-labs/vault/index.md","sourceDirName":"self-paced-labs/vault","slug":"/self-paced-labs/vault/","permalink":"/docs/self-paced-labs/vault/","draft":false,"unlisted":false,"editUrl":"https://github.com/cloud-native-taiwan/Infra-Labs-Docs/tree/main/docs/self-paced-labs/vault/index.md","tags":[],"version":"current","frontMatter":{"description":""},"sidebar":"self_paced_labs","previous":{"title":"KWOK in Docker - \u9ad4\u9a57\u4e0a\u5343\u7bc0\u9ede\u7684 K8s \u5de5\u5177","permalink":"/docs/self-paced-labs/kwok-in-docker/"},"next":{"title":"Helm Chart \u6574\u5408\u4ee5 Quarkus \u70ba\u4f8b","permalink":"/docs/self-paced-labs/quarkus-with-helm-charts/"}}');var a=s(4848),t=s(8453);const r={description:""},c="Quarkus \u6574\u5408 Vault KV \u5f15\u64ce",i={},d=[{value:"\u5be6\u9a57\u74b0\u5883",id:"\u5be6\u9a57\u74b0\u5883",level:2},{value:"\u74b0\u5883\u5b89\u88dd\u8207\u914d\u7f6e",id:"\u74b0\u5883\u5b89\u88dd\u8207\u914d\u7f6e",level:2},{value:"KV secrets engine - version 2",id:"kv-secrets-engine---version-2",level:2},{value:"\u5efa\u7acb\u7d66\u61c9\u7528\u7a0b\u5f0f\u7684 KV \u5c0d",id:"\u5efa\u7acb\u7d66\u61c9\u7528\u7a0b\u5f0f\u7684-kv-\u5c0d",level:3},{value:"\u6aa2\u7d22\u7279\u5b9a\u7248\u672c",id:"\u6aa2\u7d22\u7279\u5b9a\u7248\u672c",level:3},{value:"\u522a\u9664\u8207\u5fa9\u539f\u7248\u672c",id:"\u522a\u9664\u8207\u5fa9\u539f\u7248\u672c",level:3},{value:"\u5b9a\u7fa9\u8a2a\u554f quarkus/vault-demo \u7684\u89d2\u8272",id:"\u5b9a\u7fa9\u8a2a\u554f-quarkusvault-demo-\u7684\u89d2\u8272",level:2},{value:"Quarkus \u6574\u5408 Vault",id:"quarkus-\u6574\u5408-vault",level:2},{value:"\u5730\u7aef\u958b\u767c",id:"\u5730\u7aef\u958b\u767c",level:3},{value:"Kubernetes \u74b0\u5883",id:"kubernetes-\u74b0\u5883",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"quarkus-\u6574\u5408-vault-kv-\u5f15\u64ce",children:"Quarkus \u6574\u5408 Vault KV \u5f15\u64ce"})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["\u672c\u7bc7\u6587\u7ae0\u5167\u5bb9\u8207\u5be6\u9a57\u6703\u540c\u6b65 ",(0,a.jsx)(n.a,{href:"https://github.com/CCH0124/quarkus-demo/tree/main/vault-demo/example/vault",children:"CCH0124 - vault-demo"})]})}),"\n",(0,a.jsxs)(n.p,{children:["HashiCorp Vault \u5c6c\u65bc CNCF \u7684 ",(0,a.jsx)(n.a,{href:"https://landscape.cncf.io/card-mode?category=key-management&grouping=category",children:"Key Management"})," \u985e\u5225\u7684\u4e00\u54e1\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u73fe\u4eca\u670d\u52d9\u958b\u767c\u5c0d\u65bc\u61c9\u7528\u7a0b\u5f0f\u5b58\u53d6\u6a5f\u5bc6\u6027\u8cc7\u6599\u76f8\u5c0d\u90fd\u662f\u96e3\u514d\uff0c\u7121\u8ad6\u662f\u5728\u539f\u59cb\u78bc\u3001\u914d\u7f6e\u6a94\u6216\u662f\u5176\u5b83\u4f4d\u7f6e\u3002\u5982\u679c\u6c92\u6709\u4e00\u500b\u6a5f\u5236\u4f86\u63a7\u7ba1\u6388\u6b0a\uff0c\u60f3\u5fc5\u662f\u76f8\u7576\u7684\u53ef\u6015\u96a8\u6642\u90fd\u6709\u6d29\u6f0f\u5371\u6a5f\u3002\u900f\u904e Vault \u53ef\u4ee5\u96c6\u4e2d\u7ba1\u7406\u9019\u4e9b\u6a5f\u5bc6\u8cc7\u6e90\uff0c\u61c9\u7528\u7a0b\u5f0f\u6216\u662f\u4f7f\u7528\u8005\u8981\u5b58\u53d6\u6a5f\u5bc6\u8cc7\u6e90\u90fd\u9700\u7d93\u904e\u8eab\u5206\u9a57\u8b49\u4f86\u7372\u53d6\u76f8\u5c0d\u61c9\u8a2a\u554f\u8cc7\u6e90\uff0c\u9019\u6a23\u53ef\u6e1b\u5c11\u4e0d\u5fc5\u8981\u7684\u6d29\u6f0f\u3002"}),"\n",(0,a.jsx)(n.p,{children:"\u672c\u6587\u7ae0\u6703\u5b78\u7fd2\u5230\u4ee5\u4e0b"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u5b89\u88dd Vault"}),"\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528 Vault Client \u4ea4\u4e92"}),"\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528 KV \u5f15\u64ce"}),"\n",(0,a.jsx)(n.li,{children:"\u8a2d\u7f6e Vault Auth (Token/Kubernetes)"}),"\n",(0,a.jsx)(n.li,{children:"\u8a2d\u7f6e Vault Policy"}),"\n",(0,a.jsx)(n.li,{children:"Quarkus \u6846\u67b6\u6574\u5408 Vault KV \u5f15\u64ce"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u5be6\u9a57\u74b0\u5883",children:"\u5be6\u9a57\u74b0\u5883"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"OS: Windows 11 WSL"}),"\n",(0,a.jsx)(n.li,{children:"Docker Engine: 23.0.5"}),"\n",(0,a.jsx)(n.li,{children:"k3d version: v5.4.9"}),"\n",(0,a.jsx)(n.li,{children:"kubectl version: v1.27.1"}),"\n",(0,a.jsx)(n.li,{children:"Helm version: v3.11.3"}),"\n",(0,a.jsx)(n.li,{children:"Vault chart version: 0.25.0"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u74b0\u5883\u5b89\u88dd\u8207\u914d\u7f6e",children:"\u74b0\u5883\u5b89\u88dd\u8207\u914d\u7f6e"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.docker.com/engine/install/ubuntu/",children:"install docker"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-on-linux",children:"install kubectl"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://k3d.io/v5.4.9/#install-script",children:"install k3d"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u5b89\u88dd\u5b8c k3d \u5f8c\uff0c\u4f7f\u7528\u4e0b\u9762 k3d \u914d\u7f6e\u6a94\u6848\u5efa\u7acb\u4e00\u500b Kubernetes \u74b0\u5883 :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'## vault-conf.yaml\napiVersion: k3d.io/v1alpha4 # this will change in the future as we make everything more stable\nkind: Simple # internally, we also have a Cluster config, which is not yet available externally\nmetadata:\n  name: vault-cluster # name that you want to give to your cluster (will still be prefixed with `k3d-`)\nservers: 1 # same as `--servers 1`\nagents: 2 # same as `--agents 2`\nkubeAPI: # same as `--api-port myhost.my.domain:6445` (where the name would resolve to 127.0.0.1)\n  host: "vault.cch.com" # important for the `server` setting in the kubeconfig\n  hostIP: "127.0.0.1" # where the Kubernetes API will be listening on\n  hostPort: "6450"\nimage: rancher/k3s:v1.23.14-k3s1\nnetwork: argo-net\nports:\n  - port: 8050:80\n    nodeFilters:\n      - loadbalancer\n  - port: 8453:443\n    nodeFilters:\n      - loadbalancer\noptions:\n  k3s:\n    extraArgs:\n      - arg: --disable=traefik\n        nodeFilters:\n          - server:*\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"k3d"})," \u547d\u4ee4\u5de5\u5177\u5b89\u88dd\u6a21\u64ec\u7684 Kubernetes \u74b0\u5883\uff0c\u914d\u7f6e\u6a94\u6307\u5411\u4e0a\u8ff0\u5b9a\u7fa9\u7684\u6a94\u6848"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ k3d cluster create --config=vault-conf.yaml\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u7576 Kubernetes \u74b0\u5883\u88ab\u5efa\u7acb\u4e4b\u5f8c\uff0c\u900f\u904e ",(0,a.jsx)(n.code,{children:"kubectl config"})," \u6307\u4ee4\u53ef\u4ee5\u770b\u5230\u88ab\u5efa\u7acb\u7684\u74b0\u5883\u5982\u4e0b"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ kubectl config get-contexts\nCURRENT   NAME                                                                 CLUSTER                                                              AUTHINFO                                                             NAMESPACE\n*         k3d-vault-cluster                                                    k3d-vault-cluster                                                    admin@k3d-vault-cluster\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/#from-apt-debianubuntu",children:"Install Helm"})}),"\n",(0,a.jsx)(n.li,{children:"Install Nginx ingress controller:"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728 ",(0,a.jsx)(n.code,{children:"k3d"})," \u4e0a\u5b89\u88dd Kubernetes \u6642\u95dc\u9589\u4e86 ",(0,a.jsx)(n.code,{children:"traefik"})," \u9078\u9805\uff0c\u6240\u4ee5\u9019\u908a\u7528 ",(0,a.jsx)(n.code,{children:"ingress-nginx"})," \u53d6\u4ee3\uff0c\u4e26\u4f7f\u7528 Helm chart \u5b89\u88dd\uff0c\u5b89\u88dd\u6b65\u9a5f\u5982\u4e0b\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ helm repo add ingress-nginx  https://kubernetes.github.io/ingress-nginx\n$ helm search repo ingress-nginx\n$ helm install ingress-nginx ingress-nginx/ingress-nginx --version 4.6.0 --namespace ingress-nginx --create-namespace\n$ kubectl get all -n ingress-nginx\nNAME                                            READY   STATUS    RESTARTS   AGE\npod/ingress-nginx-controller-7d5fb757db-gx8hp   1/1     Running   0          2m36s\n\nNAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP                        PORT(S)                      AGE\nservice/ingress-nginx-controller-admission   ClusterIP      10.43.138.141   <none>                             443/TCP                      2m36s\nservice/ingress-nginx-controller             LoadBalancer   10.43.236.109   172.19.0.2,172.19.0.3,172.19.0.4   80:32369/TCP,443:31027/TCP   2m36s\n\nNAME                                       READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/ingress-nginx-controller   1/1     1            1           2m36s\n\nNAME                                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps/ingress-nginx-controller-7d5fb757db   1         1         1       2m36s\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"6",children:["\n",(0,a.jsx)(n.li,{children:"Install Vault:"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528 Helm chart \u5b89\u88dd"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm repo add hashicorp https://helm.releases.hashicorp.com\nhelm search repo hashicorp/vault\nquarkus-demo/vault-demo$ helm install vault hashicorp/vault --version 0.25.0 --namespace vault --create-namespace -f values/vault/values.yaml\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u95dc\u65bc Vault \u7684 ",(0,a.jsx)(n.code,{children:"values.yaml"})," \u5b89\u88dd\u914d\u7f6e\u53ef\u53c3\u8003\u6211\u7684",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/CCH0124/quarkus-demo/main/vault-demo/values/vault/values.yaml",children:"\u93c8\u7d50"})]}),"\n",(0,a.jsx)(n.p,{children:"\u5b89\u88dd\u5b8c\u4e4b\u5f8c\u5fc5\u9808\u4f5c\u521d\u59cb\u5316\u548c\u89e3\u5c01\u7684\u52d5\u4f5c\uff0c\u6d41\u7a0b\u5982\u4e0b:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u521d\u59cb\u5316\n$ kubectl --namespace vault exec -it vault-0 -- vault operator init\nUnseal Key 1: rie1qIyzUi7hBPNkHPgI5FAni67Dwd8or8F1pK5BHGHP\nUnseal Key 2: V1JTIz+PZOJRpWen8eGBu3a/f70rurWh57gF7prZTy1+\nUnseal Key 3: sbYXRQ74xQJmEC8JjoL6i5W2SzydEK81sI7fyUTX1QFW\nUnseal Key 4: 4cAAitfZP5wOy6Dv/9poBuPa8r6HjJ11OYNgDcVUiFMz\nUnseal Key 5: kkEnDx8VPY3IzHMIY2zF+DntuH8W+ZhelDlK7Z6e7VIq\n\nInitial Root Token: hvs.3nqeHIjaG8aIMZmmBuOPSlM4\n\nVault initialized with 5 key shares and a key threshold of 3. Please securely\ndistribute the key shares printed above. When the Vault is re-sealed,\nrestarted, or stopped, you must supply at least 3 of these keys to unseal it\nbefore it can start servicing requests.\n\nVault does not store the generated root key. Without at least 3 keys to\nreconstruct the root key, Vault will remain permanently sealed!\n\nIt is possible to generate new unseal keys, provided you have a quorum of\nexisting unseal keys shares. See "vault operator rekey" for more information.\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u89e3\u5c01\uff0c\u9810\u8a2d\u4e0a\u81f3\u5c11\u9078\u4e09\u500b Unseal Key\n$ kubectl --namespace vault exec -ti vault-0 -- vault operator unseal rie1qIyzUi7hBPNkHPgI5FAni67Dwd8or8F1pK5BHGHP\n$ kubectl --namespace vault exec -ti vault-0 -- vault operator unseal sbYXRQ74xQJmEC8JjoL6i5W2SzydEK81sI7fyUTX1QFW\n$ kubectl --namespace vault exec -ti vault-0 -- vault operator unseal kkEnDx8VPY3IzHMIY2zF+DntuH8W+ZhelDlK7Z6e7VIq\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"7",children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://developer.hashicorp.com/vault/downloads",children:"Install Vault client"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u8981\u5b89\u88dd\u7684\u539f\u56e0\u662f\u4e0d\u60f3\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"kubectl exec"})," \u65b9\u5f0f\u9032\u884c\u4e00\u4e9b\u914d\u7f6e\uff0c\u56e0\u6b64\u4ea4\u4e92\u6703\u5f9e windows WSL \u74b0\u5883\u70ba\u8acb\u6c42\u7aef\uff0c\u518d\u900f\u904e ingress \u7684\u5165\u53e3\u9032\u884c\u5b58\u53d6\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728 WSL \u74b0\u5883\u4e2d\uff0c\u9700\u5b9a\u7fa9\u5169\u500b\u74b0\u5883\u8b8a\u6578 ",(0,a.jsx)(n.code,{children:"VAULT_ADDR"})," \u548c ",(0,a.jsx)(n.code,{children:"VAULT_SKIP_VERIFY"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export VAULT_ADDR=https://vault-demo.cch.com:8453\nexport VAULT_SKIP_VERIFY=true\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"VAULT_ADDR"})," \u9019\u908a\u6307\u5411 Ingress \u5165\u53e3\u4f4d\u7f6e"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"VAULT_SKIP_VERIFY"})," \u56e0\u70ba\u6c92\u6709\u5b8c\u6574\u7684 SSL\uff0c\u6240\u4ee5\u9019\u908a\u8df3\u904e\u9a57\u8b49\uff0c\u4f46\u5be6\u52d9\u4e0a\u4e0d\u5efa\u8b70"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u63a5\u8457\u900f\u904e ",(0,a.jsx)(n.code,{children:"vault login"})," \u767b\u5165\uff0c\u9019\u908a\u767b\u5165\u7684 ",(0,a.jsx)(n.code,{children:"token"})," \u662f\u4f7f\u7528\u4e0a\u500b\u6b65\u9a5f\u7684\u521d\u59cb Vault \u6642\u7522\u751f\u7684 Root Token\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault login -tls-skip-verify hvs.3nqeHIjaG8aIMZmmBuOPSlM4 \n"})}),"\n",(0,a.jsx)(n.p,{children:"\u9019\u908a\u5fc5\u9808\u8981\u80fd\u5920\u767b\u5165\uff0c\u624d\u80fd\u5f80\u4e0b\u9032\u884c\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"kv-secrets-engine---version-2",children:"KV secrets engine - version 2"}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u555f\u7528\u7248\u672c 2 \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u5f15\u64ce\u6642\uff0c\u5fc5\u9808\u900f\u904e ",(0,a.jsx)(n.code,{children:"secret"})," \u5f15\u64ce\u555f\u7528\u3002",(0,a.jsx)(n.code,{children:"secret"})," \u5f15\u64ce\u662f\u4e00\u500b\u5132\u5b58\u3001\u751f\u6210\u6216\u662f\u52a0\u5bc6\u6578\u64da\u7684\u7d44\u4ef6\u3002\u7248\u672c 2 \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u5f15\u64ce\u662f\u4e00\u500b\u53ef\u5b58\u53d6 key/value \u5c0d\u7684\u529f\u80fd\uff0c\u4e26\u4e14\u9644\u5e36\u904e\u53bb\u6bcf\u6b21\u7570\u52d5\u7248\u672c\u6b77\u7a0b\uff0c\u56e0\u6b64\u820a\u7684\u914d\u7f6e\u662f\u53ef\u4ee5\u88ab\u6aa2\u7d22\u7684\uff0c\u4e0b\u5716\u70ba\u5b98\u65b9\u63d0\u4f9b\u7684\u5716\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dtutorials%26version%3Dmain%26asset%3Dpublic%252Fimg%252Fvault%252Fversioned-kv-1.png%26width%3D1056%26height%3D353&w=1080&q=75",alt:""})}),"\n",(0,a.jsxs)(n.p,{children:["\u5c0d\u65bc\u61c9\u7528\u7a0b\u5f0f\u5b58\u53d6\u800c\u8a00\uff0c\u5fc5\u9808\u8981\u5148\u555f\u7528 ",(0,a.jsx)(n.code,{children:"KV"})," \u529f\u80fd\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault secrets enable -version=2 kv\nSuccess! Enabled the kv secrets engine at: kv/\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u900f\u904e ",(0,a.jsx)(n.code,{children:"list"})," \u6307\u4ee4\u53ef\u4ee5\u5217\u51fa\u6211\u5011\u5275\u5efa\u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u8def\u5f91\u5f15\u64ce"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault secrets list\nPath          Type         Accessor              Description\n----          ----         --------              -----------\ncubbyhole/    cubbyhole    cubbyhole_293822d8    per-token private secret storage\nidentity/     identity     identity_5bba97e7     identity store\nkv/           kv           kv_cd1f8bda           n/a # \u9019\u662f\u88ab\u555f\u7528\u7684 KV \u5f15\u64ce\uff0c\u8def\u5f91\u662f kv\nsys/          system       system_6e9e02ef       system endpoints used for control, policy and debugging\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5efa\u7acb\u7d66\u61c9\u7528\u7a0b\u5f0f\u7684-kv-\u5c0d",children:"\u5efa\u7acb\u7d66\u61c9\u7528\u7a0b\u5f0f\u7684 KV \u5c0d"}),"\n",(0,a.jsxs)(n.p,{children:["Quarkus \u7bc4\u4f8b\u6703\u5b9a\u7fa9 ",(0,a.jsx)(n.code,{children:"mqtt.broker"}),"\u3001",(0,a.jsx)(n.code,{children:"mqtt.username"})," \u548c ",(0,a.jsx)(n.code,{children:"mqtt.password"})," \u4e09\u500b\u74b0\u5883\u8b8a\u6578\uff0c\u6700\u5f8c\u76ee\u6a19\u662f\u53ef\u4ee5\u900f\u904e API \u4ecb\u9762\u4f86\u7372\u53d6\u5f9e Vault \u5132\u5b58\u7684\u503c\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4e0b\u9762\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"kv put"})," \u5c07\u503c\u5b9a\u7fa9\u81f3 Vault \u4e2d\u3002\u5728 Vault \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u5f15\u64ce\u4e2d\uff0c\u5b83\u985e\u4f3c\u4ee5\u8cc7\u6599\u593e\u7d50\u69cb\u70ba\u6982\u5ff5\u53bb\u5efa\u7acb\u8def\u5f91\u3002\u5728\u6b64\u7bc4\u4f8b\u4e2d\uff0c\u6703\u5728 ",(0,a.jsx)(n.code,{children:"kv"})," \u8def\u5f91\u4e0b\u5efa\u7acb\u4e00\u500b ",(0,a.jsx)(n.code,{children:"quarkus/vault-demo"})," \u8def\u5f91\uff0c\u4e26\u585e\u5165\u6211\u5011\u8981\u7d66\u61c9\u7528\u7a0b\u5f0f\u7684\u503c\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'$ vault kv put kv/quarkus/vault-demo mqtt.broker="tcp://localhost:8883" mqtt.username="demo" mqtt.password="demo1234"\n======= Secret Path =======\nkv/data/quarkus/vault-demo\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2023-08-12T14:33:34.390315381Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            1\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5efa\u7acb\u5f8c\uff0c\u53ef\u4ee5\u900f\u904e ",(0,a.jsx)(n.code,{children:"kv get"})," \u4f86\u7372\u53d6\u67d0\u8def\u5f91\u4e0b\u5df2\u7d93\u5b9a\u7fa9\u7684\u9375\u503c\u5c0d\u3002",(0,a.jsx)(n.code,{children:"version"})," \u70ba 1\uff0c\u662f\u56e0\u70ba\u6211\u5011\u63a8\u9001\u4e86\u4e00\u6b21\u503c\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv get -mount=kv quarkus/vault-demo\n======= Secret Path =======\nkv/data/quarkus/vault-demo\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2023-08-12T14:33:34.390315381Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            1 # \u4e0a\u6b65\u9a5f\u63a8\u8cc7\u6599\u6240\u4ee5\u7570\u52d5\u4e00\u6b21\n# \u4e0b\u9762\u70ba\u63a8\u9001\u7684\u9375\u503c\u5c0d\n======== Data ========\nKey              Value\n---              -----\nmqtt.broker      tcp://localhost:8883\nmqtt.password    demo1234\nmqtt.username    demo\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679c\u8cc7\u6599\u5b9a\u7fa9\u932f\u8aa4\u60f3\u8981\u505a\u4fee\u6b63\u53ef\u4ee5\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"kv patch"})," \u6307\u4ee4\uff0c\u5047\u8a2d ",(0,a.jsx)(n.code,{children:"mqtt.password"})," \u8a2d\u5b9a\u932f\u8aa4\u8981\u63db\u6210 demo12345678\u3002\u9019\u6642\u53c8\u5c0d\u8cc7\u6599\u9032\u884c\u4e86\u7570\u52d5\u56e0\u6b64 ",(0,a.jsx)(n.code,{children:"version"}),"\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv patch -mount=kv quarkus/vault-demo mqtt.password=demo12345678\n======= Secret Path =======\nkv/data/quarkus/vault-demo\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2023-08-12T14:41:39.647900006Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            2 # \u6b64\u6642\u66f4\u65b0\u5bc6\u78bc\u56e0\u6b64\u7248\u672c\u5728\u88ab\u905e\u589e\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u66f4\u65b0\u5f8c\uff0c\u518d\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"kv get"})," \u6642\u8a72 ",(0,a.jsx)(n.code,{children:"mqtt.password"})," \u61c9\u7576\u662f\u88ab\u7f6e\u63db\u904e\u503c\u3002"]}),"\n",(0,a.jsx)(n.h3,{id:"\u6aa2\u7d22\u7279\u5b9a\u7248\u672c",children:"\u6aa2\u7d22\u7279\u5b9a\u7248\u672c"}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679c\u60f3\u67e5\u770b\u904e\u53bb\u7570\u52d5\uff0c\u6216\u662f\u66f4\u65b0\u524d\u7684\u67e5\u770b\u90fd\u53ef\u4ee5\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"version"})," \u4f86\u9032\u884c\u3002\u5728\u524d\u9762\u7684\u904e\u7a0b\u4e2d\u7248\u672c\u5df2\u7d93\u905e\u589e\u81f3 2\u3002\u5982\u679c\u60f3\u56de\u982d\u770b 1 \u7684\u7248\u672c\uff0c\u53ef\u4ee5\u5982\u4e0b"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv get -version=1 -mount=kv quarkus/vault-demo\n======= Secret Path =======\nkv/data/quarkus/vault-demo\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2023-08-12T14:33:34.390315381Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            1\n\n======== Data ========\nKey              Value\n---              -----\nmqtt.broker      tcp://localhost:8883\nmqtt.password    demo1234\nmqtt.username    demo\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u9810\u8a2d\u4e0a\u7248\u672c 2 \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u5f15\u64ce ",(0,a.jsx)(n.code,{children:"Maximum number of versions"})," \u662f\u672a\u8a2d\u5b9a\uff0c\u5982\u4e0b\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"read"})," \u6307\u4ee4\u67e5\u8a62\u53ef\u7372\u53d6\u5176\u914d\u7f6e\u3002\u4f46\u53ef\u4ee5\u4f9d\u7167\u9700\u6c42\u53bb\u505a\u8abf\u6574\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault read kv/config\nKey                     Value\n---                     -----\ncas_required            false\ndelete_version_after    0s\nmax_versions            0 \n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u522a\u9664\u8207\u5fa9\u539f\u7248\u672c",children:"\u522a\u9664\u8207\u5fa9\u539f\u7248\u672c"}),"\n",(0,a.jsxs)(n.p,{children:["\u5c0d\u65bc Vault \u4e2d ",(0,a.jsx)(n.code,{children:"delete"})," \u52d5\u4f5c\u662f\u8edf\u522a\u9664\uff0c\u8a72\u7248\u672c\u6703\u88ab\u6a19\u8a18\u662f\u522a\u9664\u4e14\u5b9a\u7fa9\u4e00\u500b ",(0,a.jsx)(n.code,{children:"deletion_time"})," \u6642\u6233\uff0c\u9019\u53ef\u7528\u65bc ",(0,a.jsx)(n.code,{children:"undelete"})," \u64cd\u4f5c\u57fa\u672c\u4e0a\u53ef\u4ee5\u8a8d\u77e5\u6210\u56de\u6efe\u3002\u7576 ",(0,a.jsx)(n.code,{children:"KV"})," \u7248\u672c\u8d85\u904e ",(0,a.jsx)(n.code,{children:"max-versions"})," \u8a2d\u7f6e\u7684\u6578\u91cf\u6642\uff0c\u6216\u8005\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"destroy"})," \u64cd\u4f5c\u6642\uff0c\u7248\u672c\u7684\u6578\u64da\u624d\u6703\u88ab\u6c38\u4e45\u522a\u9664\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u522a\u9664\u7248\u672c 1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv delete -versions=1 -mount=kv quarkus/vault-demo\nSuccess! Data deleted (if it existed) at: kv/data/quarkus/vault-demo\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u522a\u9664\u5f8c\uff0c\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"metadata"})," \u64cd\u4f5c\u7372\u53d6\u8a73\u7d30\u7248\u672c\u8cc7\u8a0a\u3002",(0,a.jsx)(n.code,{children:"Version 1"})," \u522a\u9664\u5f8c\u88ab\u5b9a\u7fa9\u4e86 ",(0,a.jsx)(n.code,{children:"deletion_time"}),"\uff0c\u8868\u793a\u4e0d\u6703\u88ab\u7acb\u5373\u79fb\u9664\u3002\u6b64\u6642\u6ce8\u610f ",(0,a.jsx)(n.code,{children:"Version 2"})," \u56e0\u70ba\u6c92\u505a ",(0,a.jsx)(n.code,{children:"delete"})," \u52d5\u4f5c\u56e0\u6b64 ",(0,a.jsx)(n.code,{children:"deletion_time"})," \u6c92\u88ab\u5b9a\u7fa9\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv metadata get  -mount=kv quarkus/vault-demo\n======== Metadata Path ========\nkv/metadata/quarkus/vault-demo\n\n========== Metadata ==========\nKey                     Value\n---                     -----\ncas_required            false\ncreated_time            2023-08-12T14:33:34.390315381Z\ncurrent_version         2\ncustom_metadata         <nil>\ndelete_version_after    0s\nmax_versions            0\noldest_version          0\nupdated_time            2023-08-12T14:41:39.647900006Z\n\n====== Version 1 ======\nKey              Value\n---              -----\ncreated_time     2023-08-12T14:33:34.390315381Z\ndeletion_time    2023-08-12T17:12:50.563260118Z # deletion_time \u88ab\u5b9a\u7fa9\uff0c\u8868\u793a\u4e0d\u6703\u88ab\u7acb\u5373\u79fb\u9664\ndestroyed        false\n\n====== Version 2 ======\nKey              Value\n---              -----\ncreated_time     2023-08-12T14:41:39.647900006Z\ndeletion_time    n/a\ndestroyed        false\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5617\u8a66\u5fa9\u539f\u7248\u672c 1\uff0c\u6ce8\u610f\u5230 ",(0,a.jsx)(n.code,{children:"deletion_time"})," \u6b04\u4f4d\u6642\u6233\u88ab\u8a2d\u7f6e\u70ba ",(0,a.jsx)(n.code,{children:"n/a"}),"\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault kv undelete -versions=1 -mount=kv quarkus/vault-demo\nSuccess! Data written to: kv/undelete/quarkus/vault-demo\n$ vault kv metadata get  -mount=kv quarkus/vault-demo\n======== Metadata Path ========\nkv/metadata/quarkus/vault-demo\n...\n====== Version 1 ======\nKey              Value\n---              -----\ncreated_time     2023-08-12T14:33:34.390315381Z\ndeletion_time    n/a # \u8981\u88ab\u522a\u9664\u6642\u9593\u5df2\u7d93\u8a2d\u56de\u539f\u59cb\ndestroyed        false\n\n...\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u81f3\u65bc ",(0,a.jsx)(n.code,{children:"destroy"})," \u64cd\u4f5c\uff0c\u4e0d\u63a5\u7e8c\u5c55\u793a\u57fa\u672c\u4e0a\u662f\u6703\u76f4\u63a5\u5c07\u6307\u5b9a\u7248\u672c\u8cc7\u6e90\u522a\u9664\uff0c\u4e0d\u505a\u4efb\u4f55\u6a19\u8a18\u3002"]}),"\n",(0,a.jsx)(n.h2,{id:"\u5b9a\u7fa9\u8a2a\u554f-quarkusvault-demo-\u7684\u89d2\u8272",children:"\u5b9a\u7fa9\u8a2a\u554f quarkus/vault-demo \u7684\u89d2\u8272"}),"\n",(0,a.jsxs)(n.p,{children:["\u4ee5\u6b64\u7bc4\u4f8b\u4f86\u8aaa\u61c9\u7528\u7a0b\u5f0f\u53ea\u60f3\u8981\u8b80\u53d6 ",(0,a.jsx)(n.code,{children:"quarkus/vault-demo"})," \u9019\u500b\u8def\u5f91\u4e0b\u7684\u8cc7\u6e90\uff0c\u56e0\u6b64\u8981\u7d66\u4e88\u9069\u7576\u6b0a\u9650\uff0c\u540c\u6642\u6e1b\u5c11\u653b\u64ca\u9762\u3002\u4e0b\u9762\u5b9a\u7fa9\u4e86\u4e00\u500b\u653f\u7b56\u7684\u6a94\u6848\uff0c\u91dd\u5c0d\u9019 ",(0,a.jsx)(n.code,{children:"kv/data/quarkus/vault-demo"})," \u8def\u5f91\u53ea\u7d66\u4e88\u8b80(read)\u6b0a\u9650\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# policy.hcl\npath "kv/data/quarkus/vault-demo" {\n    capabilities = ["read"]\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679c\u5c07 ",(0,a.jsx)(n.code,{children:"path"})," \u5b9a\u7fa9 ",(0,a.jsx)(n.code,{children:"kv/data/quarkus/+"})," \u5176\u5be6\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u5c31\u770b\u61c9\u7528\u65b9\u9762\u5230\u54ea\u88e1\u3002",(0,a.jsx)(n.code,{children:"+"})," \u8868\u793a\u7576\u4e0b\u540c\u5c64\u8def\u5f91\u90fd\u53ef\u5b58\u53d6"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"kv/data/quarkus/a"}),"\n",(0,a.jsx)(n.li,{children:"kv/data/quarkus/b"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u4f46\u662f\u4e0b\u9762\u662f\u7121\u6cd5\u88ab\u5b58\u53d6"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"kv/data/quarkus/a/a"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u5c07\u4e0a\u8ff0 ",(0,a.jsx)(n.code,{children:"policy.hcl"})," \u5beb\u5165 Vault \u4e2d\uff0c\u900f\u904e ",(0,a.jsx)(n.code,{children:"policy write"})," \u6307\u4ee4\u3002\u5efa\u7acb\u4e4b\u5f8c\uff0c\u900f\u904e ",(0,a.jsx)(n.code,{children:"policy list"})," \u53ef\u4ee5\u67e5\u770b\u662f\u5426\u88ab\u5efa\u7acb\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault policy write vault policy.hcl\nSuccess! Uploaded policy: vault\n$ vault policy list\ndefault\nvault # \u5efa\u7acb\u7684 policy \u540d\u7a31\u662f vault\nroot\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u7576\u7136\u9019\u6a23\u5b9a\u7fa9\u4e86\u6b0a\u9650\u9084\u4e0d\u5920\uff0c\u56e0\u70ba\u5b83\u6c92\u88ab\u7d81\u5b9a\u5230\u67d0\u500b\u4e3b\u984c\u53ef\u80fd\u662f\u4e00\u500b ",(0,a.jsx)(n.code,{children:"token"})," \u670d\u52d9\u6216\u662f ",(0,a.jsx)(n.code,{children:"user/pass"})," \u670d\u52d9\u3002\u622a\u81f3\u7576\u524d\u90fd\u662f\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"root"})," \u7684 ",(0,a.jsx)(n.code,{children:"token"})," \u505a\u64cd\u4f5c\uff0c\u61c9\u7528\u7a0b\u5f0f\u7684\u5b58\u53d6\u4e0d\u61c9\u8a72\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"root"})," \u6b0a\u9650\u9032\u884c\u64cd\u4f5c\uff0c\u56e0\u6b64\u9700\u8981\u518d\u5b9a\u7fa9\u4e00\u500b\u5c6c\u65bc\u61c9\u7528\u7a0b\u5f0f\u5b58\u53d6\u7684 ",(0,a.jsx)(n.code,{children:"token"}),"\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u900f\u904e ",(0,a.jsx)(n.code,{children:"token create"})," \u5efa\u7acb\u4e00\u500b ",(0,a.jsx)(n.code,{children:"token"})," \u5982\u4e0b\uff0c\u4e26\u8ce6\u4e88\u8a72\u6709\u7684\u6b0a\u9650\uff0c\u6642\u6548\u53ef\u7528 ",(0,a.jsx)(n.code,{children:"ttl"})," \u8a2d\u5b9a\u3002",(0,a.jsx)(n.code,{children:"token lookup"})," \u53ef\u4ee5\u67e5\u770b\u8a72 ",(0,a.jsx)(n.code,{children:"token"})," \u5167\u5bb9\uff0c\u50cf\u662f\u904e\u671f\u6642\u9593(expire_time)\u3001\u53ef\u5b58\u53d6\u7684\u653f\u7b56(policies)\u7b49\u7b49\u3002",(0,a.jsx)(n.code,{children:"-policy"})," \u7d81\u5b9a\u4e86\u4e0a\u6b65\u9a5f\u88ab\u5b9a\u7fa9\u70ba ",(0,a.jsx)(n.code,{children:"vault"})," \u7684\u653f\u7b56\uff0c\u61c9\u7528\u7a0b\u5f0f\u7bc4\u4f8b\u5c07\u4f7f\u7528\u6b64 ",(0,a.jsx)(n.code,{children:"token"})," \u9032\u884c\u5b58\u53d6\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'$ vault token create -policy=vault --ttl=768h\nKey                  Value\n---                  -----\ntoken                hvs.CAESIIDXLAV0-_yh1VJjVQkDxojDEP54lTfT0Y-UsVEBJKBhGh4KHGh2cy5lRFRMeFpBSmpGMGo2ZXRNR0RsTDh3UmI\ntoken_accessor       KqbfPMrF6pmmFLb4n7E1niob\ntoken_duration       768h\ntoken_renewable      true\ntoken_policies       ["default" "vault"]\nidentity_policies    []\npolicies             ["default" "vault"]\n\n$ vault token lookup -accessor KqbfPMrF6pmmFLb4n7E1niob\nKey                 Value\n---                 -----\naccessor            KqbfPMrF6pmmFLb4n7E1niob\ncreation_time       1692449442\ncreation_ttl        768h\ndisplay_name        token\nentity_id           n/a\nexpire_time         2023-09-20T12:50:42.985961541Z\nexplicit_max_ttl    0s\nid                  n/a\nissue_time          2023-08-19T12:50:42.985964311Z\nmeta                <nil>\nnum_uses            0\norphan              false\npath                auth/token/create\npolicies            [default vault]\nrenewable           true\nttl                 767h59m36s\ntype                service\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5c0d\u65bc ",(0,a.jsx)(n.code,{children:"token"})," \u9810\u8a2d\u7cfb\u7d71 ",(0,a.jsx)(n.code,{children:"TTL"})," \u503c\u662f ",(0,a.jsx)(n.code,{children:"768h"})," \u5982\u4e0b\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault read sys/auth/token/tune\nKey                  Value\n---                  -----\ndefault_lease_ttl    768h\ndescription          token based credentials\nforce_no_cache       false\nmax_lease_ttl        768h\ntoken_type           default-service\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u8981\u91dd\u5c0d ",(0,a.jsx)(n.code,{children:"TTL"})," \u9032\u884c\u8abf\u6574\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\uff0c\u9019\u908a\u8981\u8abf\u6574\u7684\u8a71\u7576\u4e0b\u767b\u5165\u8005\u5fc5\u9808\u6709\u8db3\u5920\u6b0a\u9650\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault write sys/auth/token/tune default_lease_ttl=8h max_lease_ttl=720h\n"})}),"\n",(0,a.jsx)(n.h2,{id:"quarkus-\u6574\u5408-vault",children:"Quarkus \u6574\u5408 Vault"}),"\n",(0,a.jsxs)(n.p,{children:["\u4e0a\u9762\u7ae0\u7bc0\u900f\u904e Vault \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u7d66\u670d\u52d9\u5efa\u7acb\u4e00\u500b\u53ef\u5b58\u653e\u6a5f\u5bc6\u7269\u4ef6\u7684\u8cc7\u6e90\u4e26\u5c07\u91cd\u8981\u7684\u8cc7\u6e90\u5b58\u653e\u81f3\u8a72\u8def\u5f91\u4e0a\u3002\u540c\u6642\u9593\uff0c\u4e5f\u5efa\u7acb\u4e86\u4e00\u500b ",(0,a.jsx)(n.code,{children:"policy"})," \u8cc7\u6e90\u4e26\u5c07\u5176\u548c ",(0,a.jsx)(n.code,{children:"token"})," \u8cc7\u6e90\u7d81\u5728\u4e00\u8d77\u7d66\u61c9\u7528\u7a0b\u5f0f\u505a\u5b58\u53d6\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u6b64\u7ae0\u7bc0\u6703\u900f\u904e Quarkus \u6846\u67b6\u8207 Vault \u9032\u884c\u4e00\u500b\u6574\u5408\u7bc4\u4f8b\u3002\u6703\u5206\u6210\u5169\u90e8\u5206\u4f86\u8aaa\u660e"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u5730\u7aef\u958b\u767c"}),"\n",(0,a.jsx)(n.li,{children:"\u4f48\u7f72\u81f3 Kubernetes \u74b0\u5883"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Quarkus \u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"io.quarkiverse.vault:quarkus-vault"})," \u7b2c\u4e09\u65b9\u5957\u4ef6\u6574\u5408 Vault\uff0c\u63a5\u7e8c\u5c07\u6703\u5be6\u4f5c\u6574\u5408\u90e8\u5206\u3002\u7bc4\u4f8b\u4e2d\u7c21\u55ae\u7684\u4f7f\u7528\u5916\u90e8\u74b0\u5883\u8b8a\u6578\uff0c\u5982\u4e0b"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"mqtt.broker=\nmqtt.username=\nmqtt.password=\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u9019\u4e9b\u503c\u5728\u4e0a\u9762\u7ae0\u7bc0\u5df2\u7d93\u5b8c\u6210\u653e\u7f6e Vault \u670d\u52d9\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u5730\u7aef\u958b\u767c",children:"\u5730\u7aef\u958b\u767c"}),"\n",(0,a.jsxs)(n.p,{children:["\u9019\u908a\u518d\u9032\u884c Vault \u5b58\u53d6\u7684\u914d\u7f6e\u4f86\u8b93 Vault \u9032\u884c\u74b0\u5883\u8b8a\u6578\u7684\u6ce8\u5165\u3002\u56e0\u70ba SSL \u975e\u6b63\u5f0f\u6240\u4ee5\u9019\u908a\u4f7f\u7528\u4e86 ",(0,a.jsx)(n.code,{children:"quarkus.tls.trust-all=true"})," \u4f86\u9032\u884c\u4fe1\u4efb\u3002\u91cd\u9ede\u662f\u4e0b\u9762\u914d\u7f6e"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"%dev.quarkus.vault.authentication.client-token=hvs.CAESIIDXLAV0-_yh1VJjVQkDxojDEP54lTfT0Y-UsVEBJKBhGh4KHGh2cy5lRFRMeFpBSmpGMGo2ZXRNR0RsTDh3UmI\nquarkus.vault.url=https://vault-demo.cch.com:8453\nquarkus.vault.kv-secret-engine-mount-path=kv\nquarkus.vault.secret-config-kv-path=quarkus/vault-demo\nquarkus.vault.kv-secret-engine-version=2\n"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus.vault.authentication.client-token"})," \u8868\u793a\u4f7f\u7528 token \u65b9\u5f0f\u5c0d Vault \u9032\u884c\u5b58\u53d6"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus.vault.url"})," \u8868\u793a\u5b58\u53d6 Vault \u7684\u4f4d\u7f6e"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus.vault.kv-secret-engine-mount-path"})," \u555f\u7528 secret \u4e2d\u7684 kv \u5f15\u64ce\u639b\u8f09\u7684\u8def\u5f91"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus.vault.secret-config-kv-path"})," \u639b\u8f09\u8def\u5f91\u4e0b\u8981\u5b58\u53d6\u7684\u5b50\u8def\u5f91"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus.vault.kv-secret-engine-version"})," \u4f7f\u7528\u7684\u7248\u672c\uff0c\u9810\u8a2d\u662f 2"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u9019\u908a\u7684 ",(0,a.jsx)(n.code,{children:"%dev"})," \u662f\u6307\u5728 dev \u74b0\u5883\u4f7f\u7528\u8a72\u503c\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u9a57\u8b49\u65b9\u9762\uff0c\u5beb\u4e86\u4e00\u500b API \u63a5\u53e3\uff0c\u900f\u904e\u8a72\u63a5\u53e3\u53ef\u4ee5\u9a57\u8b49\u662f\u5426\u5f9e Vault \u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u7372\u53d6\u8cc7\u6e90"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'    @GET\n    @Path("/mqtt/config")\n    @Produces(MediaType.APPLICATION_JSON)\n    public Response config() {\n        return Response.ok(Map.of("url", mqttConnect.broker())).build();\n    } \n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u6700\u5f8c\u904b\u884c\u61c9\u7528\u7a0b\u5f0f\uff0c\u5617\u8a66\u5b58\u53d6 ",(0,a.jsx)(n.code,{children:"/hello/mqtt/config"})," \u63a5\u53e3\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u51fa\u4ed6\u78ba\u5be6\u62ff\u5230\u4e86\u8cc7\u6e90\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'$ curl http://localhost:8080/hello/mqtt/config\n{"url":"tcp://localhost:8883"}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5c0d\u65bc\u5730\u7aef\u4f86\u8aaa\u96d6\u7136 ",(0,a.jsx)(n.code,{children:"quarkus.vault.authentication.client-token"})," \u7684\u503c\u5df2\u7d93\u6709\u9650\u5236\u6b0a\u9650\u548c\u6642\u6548\uff0c\u4f46\u9084\u662f\u6703\u7fd2\u6163\u628a ",(0,a.jsx)(n.code,{children:"quarkus.vault.authentication.client-token"})," \u653e\u7f6e .env \u6a94\u6848\u4e2d\uff0c\u9019\u6a23\u57fa\u672c\u4e0a\u539f\u59cb\u78bc\u4e0d\u6703\u51fa\u73fe\u95dc\u65bc\u5b58\u53d6 Vault \u670d\u52d9\u53ef\u5b58\u53d6 API \u7684 ",(0,a.jsx)(n.code,{children:"toekn"})," \u8cc7\u6e90\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u7a0b\u5f0f\u78bc\u53ef\u53c3\u8003\u6211\u7684",(0,a.jsx)(n.a,{href:"https://github.com/CCH0124/quarkus-demo/tree/ef9e04122d4acb1ac2920d17322c23e924422c2b/vault-demo/example/vault",children:"\u93c8\u7d50"})]}),"\n",(0,a.jsx)(n.h3,{id:"kubernetes-\u74b0\u5883",children:"Kubernetes \u74b0\u5883"}),"\n",(0,a.jsxs)(n.p,{children:["\u5c0d\u65bc\u4f48\u7f72\u81f3 Kubernetes \u74b0\u5883\uff0cVault \u63d0\u4f9b\u4e86\u7528 ",(0,a.jsx)(n.code,{children:"serviceAccount"})," \u7684 ",(0,a.jsx)(n.code,{children:"token"})," \u5b58\u53d6 Vault \u670d\u52d9\u7684\u529f\u80fd\u3002\u76f8\u8f03\u65bc\u4f7f\u7528\u4e0a\u9762 ",(0,a.jsx)(n.code,{children:"token"})," \u65b9\u5f0f\uff0c\u6703\u6bd4\u8f03\u9748\u6d3b\u5f88\u591a\uff0c\u6211\u6703\u8a8d\u70ba\u4e0d\u5fc5\u7279\u5225\u7ba1\u7406 ",(0,a.jsx)(n.code,{children:"token"})," \u662f\u5426\u6703\u904e\u671f\uff0c\u6216\u662f\u7ba1\u7406\u591a\u500b ",(0,a.jsx)(n.code,{children:"token"}),"\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u8981\u4f7f\u7528 Kubernetes \u8a8d\u8b49\u5fc5\u9808\u57f7\u884c\u4ee5\u4e0b\uff0c\u9019\u908a\u6703\u4f7f\u7528 root \u6b0a\u9650\u9032\u884c\u64cd\u4f5c"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u555f\u7528\u8a72\u529f\u80fd"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault auth enable kubernetes\nSuccess! Enabled kubernetes auth method at: kubernetes/\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["\u7528 ",(0,a.jsx)(n.code,{children:"/config"})," \u4ecb\u9762\u914d\u7f6e Vault \u8207 Kubernetes \u7684\u901a\u8a0a\uff0c\u4f7f\u7528 Pod \u7684 ",(0,a.jsx)(n.code,{children:"serviceAccount"})," \u7684 ",(0,a.jsx)(n.code,{children:"token"}),"\u3002 Vault \u5c07\u5b9a\u671f\u91cd\u65b0\u8b80\u53d6\u8a72\u6a94\u6848\u4ee5\u652f\u63f4\u77ed\u671f\u4ee4\u724c(short-lived tokens)\u3002\u9019\u6a23 Vault \u5c07\u5617\u8a66\u5f9e\u9810\u8a2d\u639b\u8f09\u4f4d\u7f6e ",(0,a.jsx)(n.code,{children:"/var/run/secrets/kubernetes.io/serviceaccount/"})," \u5167\u7684 ",(0,a.jsx)(n.code,{children:"token"})," \u548c ",(0,a.jsx)(n.code,{children:"ca.crt"})," \u52a0\u8f09\u5b83\u5011\u3002"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault write auth/kubernetes/config \\\n    kubernetes_host=https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT\nSuccess! Data written to: auth/kubernetes/config\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"$KUBERNETES_SERVICE_HOST"})," \u8207 ",(0,a.jsx)(n.code,{children:"$KUBERNETES_SERVICE_PORT"})," \u662f\u74b0\u5883\u8b8a\u6578\uff0c\u9700\u66ff\u4ee3\u771f\u5be6\u7684\u503c\uff0c\u672c\u4eba\u6e2c\u8a66\u6642\u74b0\u5883\u8b8a\u6578\u4f3c\u4e4e\u7121\u6cd5\u88ab\u7cfb\u7d71\u66ff\u4ee3\u3002"]}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["\u8a2d\u5b9a\u5141\u8a31\u88ab\u5b58\u53d6\u7684 ",(0,a.jsx)(n.code,{children:"namespace"})," \u8207 ",(0,a.jsx)(n.code,{children:"serviceAccount"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ vault write auth/kubernetes/role/quarkus-vault \\\n> bound_service_account_names=vault \\\n> bound_service_account_namespaces=prod \\\n> policies=vault \\\n> ttl=1h\nSuccess! Data written to: auth/kubernetes/role/quarkus-vault\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quarkus-vault"})," \u662f\u89d2\u8272\u540d\u7a31\uff0c\u61c9\u7528\u7a0b\u5f0f\u5b58\u53d6\u7528\u6b64\u89d2\u8272"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"bound_service_account_names"})," \u53ef\u4f7f\u7528\u8a72\u89d2\u8272\u7684 ",(0,a.jsx)(n.code,{children:"serviceAccout"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"bound_service_account_namespaces"})," \u53ef\u4f7f\u7528\u8a72\u89d2\u8272\u7684 ",(0,a.jsx)(n.code,{children:"namespace"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"policies"})," \u8a72\u89d2\u8272\u7d81\u5b9a\u7684\u653f\u7b56\uff0c\u9019\u908a\u6703\u5c0d\u61c9\u4e0a\u9762\u6240\u8a2d\u5b9a\u7684\u653f\u7b56"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Vault \u4e2d\u4e00\u500b\u89d2\u8272\u80fd\u88ab kubernetes \u4e2d\u7684 namespace \u4e0b\u7684\u591a\u500b serviceAccount \u8cc7\u6e90\u5171\u540c\u6240\u4f7f\u7528\uff0c\u653f\u7b56\u540c\u6a23\u4e5f\u53ef\u4ee5\u7d81\u5b9a\u591a\u500b\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u7576\u8a2d\u5b9a\u597d\u4e4b\u5f8c\uff0c\u5728 Quarkus \u5c08\u6848\u4e2d\u7684 ",(0,a.jsx)(n.code,{children:"application.properties"})," \u6a94\u6848\u5b9a\u7fa9\u4ee5\u4e0b\uff0c\u8868\u793a\u5728 prod \u74b0\u5883\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u5b9a\u7fa9\u7684\u503c\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"%prod.quarkus.vault.url=http://vault.vault.svc.cluster.local:8200\n%prod.quarkus.vault.authentication.kubernetes.role=quarkus-vault\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u63a5\u8457\u5617\u8a66\u4f48\u7f72\u6211\u5011\u7684\u61c9\u7528\u7a0b\u5f0f\u81f3 k3d \u6a21\u64ec\u7684 Kubernetes \u74b0\u5883\uff0c\u4e0b\u9762\u662f\u90e8\u5206 deployment.yaml \u6a94\u6848\u5167\u5bb9\u8a73\u7d30\u53ef\u53c3\u8003\u6b64",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/CCH0124/quarkus-demo/main/vault-demo/example/vault/kubernetes/deployment.yaml",children:"\u93c8\u7d50"}),"\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# deployment.yaml\n...\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app.kubernetes.io/managed-by: quarkus\n    app.kubernetes.io/name: vault\n    app.kubernetes.io/version: 1.0.0-SNAPSHOT\n    app.kubernetes.io/part-of: vault\n  name: vault\n  namespace: prod\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: vault\n      app.kubernetes.io/version: 1.0.0-SNAPSHOT\n      app.kubernetes.io/part-of: vault\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/managed-by: quarkus\n        app.kubernetes.io/name: vault\n        app.kubernetes.io/version: 1.0.0-SNAPSHOT\n        app.kubernetes.io/part-of: vault\n      namespace: prod\n    spec:\n      containers:\n        - env:\n            - name: KUBERNETES_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n          image: registry.hub.docker.com/cch0124/vault:788ed52\n          imagePullPolicy: Always\n          ...\n      securityContext:\n        fsGroup: 185\n        runAsGroup: 185\n        runAsNonRoot: true\n        runAsUser: 185\n      serviceAccountName: vault\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\n  labels:\n    app.kubernetes.io/name: vault\n    app.kubernetes.io/part-of: vault\n    app.kubernetes.io/version: 1.0.0-SNAPSHOT\n    app.kubernetes.io/managed-by: quarkus\n  name: vault\n  namespace: prod\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: vault-demo.cch.com\n      http:\n        paths:\n          - backend:\n              service:\n                name: vault\n                port:\n                  name: http\n            path: /api/v1(/|$)(.*)\n            pathType: Prefix\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u63a5\u8457\u900f\u904e\u4f48\u7f72 deployment.yaml \u6e2c\u8a66\uff0c\u61c9\u7528\u7a0b\u5f0f\u4f48\u7f72\u8cc7\u6e90\u5982\u4e0b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"vault-demo/example/vault/kubernetes$ kubectl apply -f deployment.yaml\n$ kubectl get all -n prod\nNAME                         READY   STATUS    RESTARTS   AGE\npod/vault-76cfcb466f-s6z2m   1/1     Running   0          6m15s\n\nNAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nservice/vault   ClusterIP   10.43.236.207   <none>        8080/TCP   34m\n\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/vault   1/1     1            1           34m\n\nNAME                               DESIRED   CURRENT   READY   AGE\nreplicaset.apps/vault-76cfcb466f   1         1         1       34m\n$ kubectl get ingress -n prod\nNAME    CLASS   HOSTS                ADDRESS                            PORTS   AGE\nvault   nginx   vault-demo.cch.com   172.18.0.2,172.18.0.3,172.18.0.4   80      35m\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u6e2c\u8a66\uff0c\u78ba\u5be6\u90a3\u5230\u4e86 ",(0,a.jsx)(n.code,{children:"KV"})," \u4e0a\u5b9a\u7fa9\u7684\u503c"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'$ curl http://vault-demo.cch.com:8050/api/v1/hello/mqtt/config\n{"url":"tcp://localhost:8883"}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u9019\u908a\uff0c\u61c9\u7528\u7a0b\u5f0f\u900f\u904e\u4e86 Vault \u4e2d kubernete \u8a8d\u8b49\u65b9\u5f0f\u5c0d Vault \u9032\u884c\u5b58\u53d6\uff0c\u800c\u975e ",(0,a.jsx)(n.code,{children:"token"})," \u8a8d\u8b49\u3002\u6574\u9ad4\u7684\u6d41\u7a0b\u6703\u5982\u4e0b\u5716\u6240\u793a"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:s(1848).A+"",width:"987",height:"579"})}),"\n",(0,a.jsx)(n.h2,{id:"\u7e3d\u7d50",children:"\u7e3d\u7d50"}),"\n",(0,a.jsxs)(n.p,{children:["Vault \u5728\u61c9\u7528\u4e0a\u53ef\u4ee5\u96c6\u4e2d\u5f0f\u7ba1\u7406\u6a5f\u5bc6\u8cc7\u6e90\uff0c\u52a0\u4e0a\u9700\u8981\u900f\u904e\u8a8d\u8b49\u624d\u80fd\u53bb\u5b58\u53d6\u8cc7\u6e90\u57fa\u672c\u4e0a\u653b\u64ca\u9762\u6216\u662f\u6d29\u6f0f\u8cc7\u8a0a\u53ef\u80fd\u6027\u5c11\u4e86\u5f88\u591a\u3002\u6b64\u7bc7\u6587\u7ae0\u900f\u904e\u4e86\u6846\u67b6\u5c0d Vault \u8cc7\u6e90\u9032\u884c\u6574\u5408\uff0c\u5176\u4f7f\u7528\u5c0d\u958b\u767c\u8005\u4f86\u8aaa\u4e5f\u662f\u8f15\u9b06\u3002\u4f46\u5c0d\u65bc\u61c9\u7528\u7a0b\u5f0f\u5b58\u53d6 Vault \u9664\u4e86\u900f\u904e\u6846\u67b6\u63d0\u4f9b\u7684\u65b9\u5f0f\uff0c\u9084\u53ef\u4ee5\u4f7f\u7528 Vault \u7684 ",(0,a.jsx)(n.code,{children:"sidecar"})," \u65b9\u5f0f\u6216\u662f CSI (Container Storage Interface) \u6574\u5408\uff0c\u5982\u679c\u662f\u5c0d\u65bc\u907a\u7559\u8f03\u4e45\u7684\u5c08\u6848\u53ef\u4ee5\u8003\u616e\u9019\u7a2e\u65b9\u5f0f\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4f46\u5982\u679c\u670d\u52d9\u591a\u7684\u8a71\uff0c\u5c0d\u65bc Vault \u4e0a\u7684 ",(0,a.jsx)(n.code,{children:"path"})," \u8a2d\u8a08\u5176\u5be6\u4e5f\u662f\u5f88\u91cd\u8981\u7684\u4e00\u74b0\uff0c\u4e0d\u61c9\u7576\u6240\u6709\u670d\u52d9\u90fd\u5c0d\u4e00\u500b\u8def\u5f91\u4e0b\u7684 ",(0,a.jsx)(n.code,{children:"KV"})," \u9032\u884c\u5b58\u53d6\u3002"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},1848:(e,n,s)=>{s.d(n,{A:()=>l});const l=s.p+"assets/images/vau_k8s_auth_flow-aa78c99285897340fdf1f9441f96cb84.png"},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var l=s(6540);const a={},t=l.createContext(a);function r(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);