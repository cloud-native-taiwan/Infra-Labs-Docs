"use strict";(self.webpackChunknew_infra_labs_docs=self.webpackChunknew_infra_labs_docs||[]).push([[624],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var i=a.createContext({}),o=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},m=function(e){var n=o(e.components);return a.createElement(i.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=o(t),d=l,h=c["".concat(i,".").concat(d)]||c[d]||u[d]||r;return t?a.createElement(h,p(p({ref:n},m),{},{components:t})):a.createElement(h,p({ref:n},m))}));function h(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,p=new Array(r);p[0]=d;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[c]="string"==typeof e?e:l,p[1]=s;for(var o=2;o<r;o++)p[o]=t[o];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6327:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>p,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>o});var a=t(7462),l=(t(7294),t(3905));const r={description:""},p="Helm Chart \u6574\u5408\u4ee5 Quarkus \u70ba\u4f8b",s={unversionedId:"self-paced-labs/quarkus-with-helm-charts/index",id:"self-paced-labs/quarkus-with-helm-charts/index",title:"Helm Chart \u6574\u5408\u4ee5 Quarkus \u70ba\u4f8b",description:"",source:"@site/docs/self-paced-labs/quarkus-with-helm-charts/index.md",sourceDirName:"self-paced-labs/quarkus-with-helm-charts",slug:"/self-paced-labs/quarkus-with-helm-charts/",permalink:"/docs/self-paced-labs/quarkus-with-helm-charts/",draft:!1,editUrl:"https://github.com/cloud-native-taiwan/Infra-Labs-Docs/tree/main/docs/self-paced-labs/quarkus-with-helm-charts/index.md",tags:[],version:"current",frontMatter:{description:""},sidebar:"self_paced_labs",previous:{title:"Quarkus \u6574\u5408 Vault KV \u5f15\u64ce",permalink:"/docs/self-paced-labs/vault/"},next:{title:"Quarkus \u6574\u5408 Vault \u8207 Secrets Store CSI Driver",permalink:"/docs/self-paced-labs/vault-secrets-store-csi-with-quarkus/"}},i={},o=[{value:"\u5be6\u9a57\u74b0\u5883",id:"\u5be6\u9a57\u74b0\u5883",level:2},{value:"\u5efa\u7acb Helm Chart",id:"\u5efa\u7acb-helm-chart",level:2},{value:"Helm charts \u6574\u5408 Kubeconform",id:"helm-charts-\u6574\u5408-kubeconform",level:2},{value:"Helm charts \u6574\u5408 kube-score",id:"helm-charts-\u6574\u5408-kube-score",level:2},{value:"charts \u55ae\u5143\u6e2c\u8a66",id:"charts-\u55ae\u5143\u6e2c\u8a66",level:2},{value:"charts \u6574\u5408 helm-docs \u7522\u751f\u6587\u4ef6",id:"charts-\u6574\u5408-helm-docs-\u7522\u751f\u6587\u4ef6",level:2},{value:"\u6253\u5305 charts \u81f3 DockerHub",id:"\u6253\u5305-charts-\u81f3-dockerhub",level:2},{value:"\u6253\u5305 charts",id:"\u6253\u5305-charts",level:3},{value:"\u767b\u5165 Docker Hub \u4e26\u63a8\u9001",id:"\u767b\u5165-docker-hub-\u4e26\u63a8\u9001",level:3},{value:"\u90e8\u7f72\u8207\u64cd\u4f5c Helm charts",id:"\u90e8\u7f72\u8207\u64cd\u4f5c-helm-charts",level:2},{value:"\u90e8\u7f72",id:"\u90e8\u7f72",level:3},{value:"\u66f4\u65b0 Helm chart",id:"\u66f4\u65b0-helm-chart",level:3},{value:"\u56de\u6efe charts",id:"\u56de\u6efe-charts",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2}],m={toc:o};function c(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"helm-chart-\u6574\u5408\u4ee5-quarkus-\u70ba\u4f8b"},"Helm Chart \u6574\u5408\u4ee5 Quarkus \u70ba\u4f8b"),(0,l.kt)("p",null,"Helm \u662f\u4e00\u500b\u7ba1\u7406 Kubernetes \u8cc7\u6e90\u7684\u6253\u5305\u5de5\u5177\uff0c\u5176\u7522\u51fa\u55ae\u5143\u53ef\u4ee5\u7a31\u70ba ",(0,l.kt)("inlineCode",{parentName:"p"},"charts"),"\uff0c\u985e\u4f3c\u65bc\u5bb9\u5668\u6620\u50cf\u6a94\u6216\u662f Ubuntu \u4e2d\u7684 apt \u7ba1\u7406\u5de5\u5177\uff0c\u56e0\u6b64\u5b83\u662f\u53ef\u4ee5\u88ab\u5efa\u7acb\u6216\u662f\u522a\u9664\u3002\u5176\u540c\u6642\u4e5f\u662f CNCF ",(0,l.kt)("a",{parentName:"p",href:"https://landscape.cncf.io/card-mode?category=application-definition-image-build&grouping=category"},"Application Definition & Image Build")," \u4e2d\u7684\u4e00\u54e1\u3002\u5e38\u898b\u985e\u4f3c\u7684\u6709 ",(0,l.kt)("a",{parentName:"p",href:"https://kustomize.io/"},"Kustomize")," \u7b49\u3002"),(0,l.kt)("p",null,"\u4e00\u822c\u898f\u5283\u4e00\u500b\u670d\u52d9\u8981\u90e8\u7f72\u5728 Kubernetes \u4e0a\u6642\u4e5f\u8a31\u6703\u5b9a\u7fa9\u5982\u4e0b\u8cc7\u6e90\u3002\u4f46\u5c0d\u65bc\u8981\u9000\u56de\u6216\u662f\u4fee\u6539\u90fd\u6703\u7dad\u8b77\u9019\u4e9b\u5927\u91cf\u8cc7\u6e90\uff0c\u5176\u5c0d\u65bc\u767c\u5e03\u7684\u61c9\u7528\u7a0b\u5f0f\u6c92\u6709\u7248\u672c\u63a7\u5236\u7684\u6982\u5ff5\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Deployment"),(0,l.kt)("li",{parentName:"ul"},"Service"),(0,l.kt)("li",{parentName:"ul"},"Ingress"),(0,l.kt)("li",{parentName:"ul"},"Secret")),(0,l.kt)("p",null,"Helm \u53ef\u4ee5\u5e6b\u52a9\u6211\u5011\u5b8c\u6210\u9019\u4e9b\u4efb\u52d9\uff0c\u4ee5\u65b9\u4fbf\u7ba1\u7406\u61c9\u7528\u7a0b\u5f0f\u8cc7\u6e90\u548c\u767c\u5e03\u7684\u751f\u547d\u9031\u671f\uff0c\u4e26\u7d71\u4e00\u7ba1\u7406\u3001\u914d\u7f6e\u548c\u66f4\u65b0\u9019\u4e9b Kubernetes \u7684\u8cc7\u6e90\u6a94\u6848"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u767c\u5e03\u548c\u5957\u7528\u4e00\u5957\u6a21\u677f"),(0,l.kt)("li",{parentName:"ul"},"\u5c07\u8cc7\u6e90\u4f5c\u70ba\u4e00\u500b charts \u4f86\u7ba1\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u5009\u5eab\u5132\u5b58\u9019\u4e9b charts")),(0,l.kt)("p",null,"\u900f\u904e\u672c\u6587\u7ae0\u6703\u5b78\u7fd2\u5230\u4ee5\u4e0b\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 charts \u7ba1\u7406\u90e8\u7f72\u81f3 Kubernetes \u8cc7\u6e90"),(0,l.kt)("li",{parentName:"ul"},"charts \u6574\u5408 Kubeconform \u9a57\u8b49 Kubernetes \u90e8\u7f72\u8cc7\u6e90"),(0,l.kt)("li",{parentName:"ul"},"charts \u6574\u5408 kube-score \u5be6\u73fe yaml \u6a94\u6848\u975c\u614b\u6383\u63cf"),(0,l.kt)("li",{parentName:"ul"},"charts \u55ae\u5143\u6e2c\u8a66"),(0,l.kt)("li",{parentName:"ul"},"charts \u6574\u5408 helm-docs \u7522\u751f\u6587\u4ef6"),(0,l.kt)("li",{parentName:"ul"},"charts \u63a8\u9001\u4ee5 Docker Hub \u4e2d Registry \u70ba\u4f8b"),(0,l.kt)("li",{parentName:"ul"},"helm \u6307\u4ee4\u4f7f\u7528")),(0,l.kt)("p",null,"\u6b64\u6587\u7ae0\u7bc4\u4f8b\u4f86\u6e90\u7a0b\u5f0f\u78bc\u53ef\u4ee5\u81f3\u6b64",(0,l.kt)("a",{parentName:"p",href:"https://github.com/CCH0124/quarkus-demo/tree/main/helm-demo"},"\u9023\u7d50")),(0,l.kt)("h2",{id:"\u5be6\u9a57\u74b0\u5883"},"\u5be6\u9a57\u74b0\u5883"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"OS: Windows 11 WSL (Ubuntu 22.04)"),(0,l.kt)("li",{parentName:"ul"},"Docker Engine: 23.0.5"),(0,l.kt)("li",{parentName:"ul"},"k3d version: v5.4.9"),(0,l.kt)("li",{parentName:"ul"},"kubectl version: v1.27.1"),(0,l.kt)("li",{parentName:"ul"},"Helm version: v3.11.3"),(0,l.kt)("li",{parentName:"ul"},"kube-score version: v1.17.0"),(0,l.kt)("li",{parentName:"ul"},"kubeconform version: v0.6.3"),(0,l.kt)("li",{parentName:"ul"},"helm-docs version: v1.11.0")),(0,l.kt)("h2",{id:"\u5efa\u7acb-helm-chart"},"\u5efa\u7acb Helm Chart"),(0,l.kt)("p",null,"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm create <name>")," \u6307\u4ee4\u5efa\u7acb\u4e00\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"charts"),"\uff0c\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm create web-app\nCreating web-app\n")),(0,l.kt)("p",null,"\u6b64\u6642\u6703\u5efa\u7acb\u4e00\u4e9b\u57fa\u790e\u7684\u8cc7\u6e90\uff0c\u66f4\u8a73\u7d30\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u7d50\u69cb\u5167\u5bb9\u53ef\u53c3\u95b1\u5176\u5b98\u65b9",(0,l.kt)("a",{parentName:"p",href:"https://helm.sh/docs/topics/charts/"},"\u6587\u4ef6"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u2514\u2500\u2500 web-app\n    \u251c\u2500\u2500 Chart.yaml # chart \u76f8\u95dc\u8cc7\u8a0a(\u7248\u672c\u865f\u7b49)\n    \u251c\u2500\u2500 charts # \u4f9d\u8cf4\u5176\u5b83 chart \u7684\u76ee\u9304\n    \u251c\u2500\u2500 templates # \u7528\u4f86\u7522\u751f Kubernetes \u8cc7\u6e90\uff0c\u6703\u8207\u5b9a\u7fa9\u7684\u503c\u8cc7\u6e90\u6574\u5408\n    \u2502   \u251c\u2500\u2500 NOTES.txt\n    \u2502   \u251c\u2500\u2500 _helpers.tpl\n    \u2502   \u251c\u2500\u2500 deployment.yaml\n    \u2502   \u251c\u2500\u2500 hpa.yaml\n    \u2502   \u251c\u2500\u2500 ingress.yaml\n    \u2502   \u251c\u2500\u2500 service.yaml\n    \u2502   \u251c\u2500\u2500 serviceaccount.yaml\n    \u2502   \u2514\u2500\u2500 tests\n    \u2502       \u2514\u2500\u2500 test-connection.yaml\n    \u2514\u2500\u2500 values.yaml\n")),(0,l.kt)("p",null,"\u56e0\u70ba\u7bc4\u4f8b\u7684\u61c9\u7528\u7a0b\u5f0f\u9700\u8981 ",(0,l.kt)("inlineCode",{parentName:"p"},"clusterrole")," \u7b49\u5176\u5b83\u8cc7\u6e90\uff0c\u56e0\u6b64\u6709\u591a\u5b9a\u7fa9\u4e00\u4e9b\u8cc7\u6e90\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u57fa\u790e\u8cc7\u6e90\u53ea\u662f\u7d66\u4e86\u90e8\u7f72\u81f3 Kubernetes \u8cc7\u6e90\u4e00\u4e9b\u57fa\u790e\u7d50\u69cb\uff0c\u61c9\u7576\u4f9d\u7167\u9700\u6c42\u81ea\u884c\u8a2d\u8a08\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"_helpers.tpl")," \u9019\u500b\u6a94\u6848\u53ef\u4ee5\u5b9a\u7fa9\u5171\u7528\u7684\u6a21\u677f\uff0c\u4ee5\u6b64\u7bc4\u4f8b\u4f86\u8aaa\u5b9a\u7fa9\u4e86\u4e00\u500b\u5171\u7528\u8a3b\u89e3\u5340\u584a\u7684\u65b9\u6cd5\uff0c\u5982\u4e0b\u3002\u8a72 ",(0,l.kt)("inlineCode",{parentName:"p"},"web-app.annotation")," \u662f\u65b9\u6cd5\u540d\u7a31\uff0c\u5176\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"define")," \u95dc\u9375\u5b57\u9032\u884c\u5b9a\u7fa9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'{{/* # \u8a3b\u89e3\u5340\u584a\ncommon annotation\n*/}}\n{{- define "web-app.annotation" -}} # \norg.cch.com/owner: cch\norg.cch.com/organize: CCH Tech\n{{- end }}\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"web-app.annotation")," \u5c07\u5176\u4f7f\u7528\u65bc ",(0,l.kt)("inlineCode",{parentName:"p"},"deployment.yaml")," \u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"metadata.annotations"),"\uff0c\u7d50\u679c\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ include "web-app.fullname" . }}\n  labels:\n    {{- include "web-app.labels" . | nindent 4 }}\n  annotations:\n    {{- include "web-app.annotation" . | nindent 4 }}\n    {{- with .Values.deploymentAnnotations }}\n      {{- toYaml . | nindent 4 }}\n    {{- end }}\nspec:\n  {{- if not .Values.autoscaling.enabled }}\n  replicas: {{ .Values.replicaCount }}\n  {{- end }}\n  selector:\n    matchLabels:\n      {{- include "web-app.selectorLabels" . | nindent 6 }}\n  template:\n    metadata:\n      annotations:\n      {{- if .Values.app.properties }}\n      checksum/config: {{ include (print $.Template.BasePath "/configmap.yaml") . | sha256sum }}\n      {{- end }}\n      {{- with .Values.podAnnotations }}\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      labels:\n        {{- include "web-app.selectorLabels" . | nindent 8 }}\n    spec:\n      {{- with .Values.imagePullSecrets }}\n      imagePullSecrets:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      serviceAccountName: {{ include "web-app.serviceAccountName" . }}\n      securityContext:\n        {{- toYaml .Values.podSecurityContext | nindent 8 }}\n      containers:\n        - name: {{ .Chart.Name }}\n          securityContext:\n            {{- toYaml .Values.securityContext | nindent 12 }}\n          image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"\n          imagePullPolicy: {{ .Values.image.pullPolicy }}\n          ports:\n            - name: http\n              containerPort: {{ .Values.service.port }}\n              protocol: TCP\n          env:\n            - name: KUBE_POD_NAME \n              valueFrom: \n                fieldRef: \n                  fieldPath: metadata.name\n            - name: KUBE_NAMESPACE\n              valueFrom: \n                fieldRef: \n                  fieldPath: metadata.namespace\n          {{- with .Values.extraEnv }}\n            {{- toYaml . | nindent 12 }}\n          {{- end }}\n          {{- with .Values.extraEnvFrom }}\n          envFrom:\n            {{- toYaml . | nindent 12 }}\n          {{- end }}\n          {{- with .Values.livenessProbe }}\n          livenessProbe:\n            {{- tpl (toYaml .) $ | nindent 12 }}\n          {{- end }}\n          {{- with .Values.readinessProbe }}\n          readinessProbe:\n            {{- tpl (toYaml .) $ | nindent 12 }}\n          {{- end }}\n          {{- with .Values.lifecycle }}\n          lifecycle:\n            {{- toYaml . | nindent 12 }}\n          {{- end }}\n          resources:\n            {{- toYaml .Values.resources | nindent 12 }}\n      {{- with .Values.nodeSelector }}\n      nodeSelector:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      {{- with .Values.affinity }}\n      affinity:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      {{- with .Values.tolerations }}\n      tolerations:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n')),(0,l.kt)("p",null,"\u9019\u908a\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"include")," \u51fd\u5f0f\u5c07\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"web-app.annotation")," \u6a21\u677f\u5f15\u5165\uff0c\u4e26\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},".")," \u5c07\u5176\u4f5c\u70ba\u4e00\u500b\u503c\uff0c\u6700\u5f8c\u5c07\u7d50\u679c\u5f80 ",(0,l.kt)("inlineCode",{parentName:"p"},"indent ")," \u51fd\u793a\u50b3\u5165\u3002Helm \u63d0\u4f9b\u591a\u7a2e\u7684\u6a21\u677f\u51fd\u6578\uff0c\u6709\u8208\u8da3\u8005\u53ef\u4ee5\u81f3\u6b64\u5b98\u65b9",(0,l.kt)("a",{parentName:"p",href:"https://helm.sh/docs/howto/charts_tips_and_tricks/"},"\u6587\u4ef6"),"\u9032\u884c\u67e5\u770b\u3002"),(0,l.kt)("p",null,"\u7576\u6a21\u677f\u5b9a\u7fa9\u597d\u4e4b\u5f8c\uff0c\u5fc5\u9808\u5c07\u5176\u586b\u5145\u8cc7\u6599\uff0c\u5426\u5247\u7121\u6cd5\u6b63\u5e38\u88ab Kubernetes \u57f7\u884c\u3002\u5728\u9810\u8a2d\u4e0a\u6703\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u9032\u884c\u586b\u5145\u3002"),(0,l.kt)("p",null,"\u4ee5\u4e0a\u9762\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"deployment.yaml")," \u6a21\u677f\u70ba\u4f8b\uff0c\u57f7\u884c\u4ee5\u4e0b\uff0c\u53ef\u4ee5\u770b\u898b\u503c\u88ab ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u586b\u5145\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# -s \u6307\u5b9a\u67d0\u500b\u8981\u88ab\u8f49\u8b6f\u7684\u6a21\u677f\n# -f \u6307\u5b9a\u5c0d\u6a21\u677f\u9032\u884c\u586b\u5145\u7684 values yaml\n$ helm template ./ -s templates/deployment.yaml -f values.yaml \n---\n# Source: web-app/templates/deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: release-name-web-app\n  labels:\n    helm.sh/chart: web-app-0.1.0\n    app.kubernetes.io/name: web-app\n    app.kubernetes.io/instance: release-name\n    app.kubernetes.io/version: "1.16.0"\n    app.kubernetes.io/managed-by: Helm\n  annotations:\n    org.cch.com/owner: cch\n    org.cch.com/organize: CCH Tech\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: web-app\n      app.kubernetes.io/instance: release-name\n  template:\n    metadata:\n      annotations:\n      checksum/config: 9370cee06587dc819f556fef23ae74570f025b5f5570ab3188bd3007ff0828f0\n      labels:\n        app.kubernetes.io/name: web-app\n        app.kubernetes.io/instance: release-name\n    spec:\n      serviceAccountName: web\n      securityContext:\n        fsGroup: 185\n        runAsNonRoot: true\n      containers:\n        - name: web-app\n          securityContext:\n            allowPrivilegeEscalation: false\n            capabilities:\n              drop:\n              - ALL\n            readOnlyRootFilesystem: false\n            runAsGroup: 185\n            runAsUser: 185\n          image: "egistry.hub.docker.com/cch0124/helm-demo:latest"\n          imagePullPolicy: IfNotPresent\n          ports:\n            - name: http\n              containerPort: 8080\n              protocol: TCP\n          env:\n            - name: KUBE_POD_NAME \n              valueFrom: \n                fieldRef: \n                  fieldPath: metadata.name\n            - name: KUBE_NAMESPACE\n              valueFrom: \n                fieldRef: \n                  fieldPath: metadata.namespace\n          livenessProbe:\n            httpGet:\n              path: /q/health/live\n              port: http\n              scheme: HTTP\n            initialDelaySeconds: 60\n            periodSeconds: 30\n            successThreshold: 1\n            timeoutSeconds: 10\n          readinessProbe:\n            httpGet:\n              path: /q/health/ready\n              port: http\n              scheme: HTTP\n            initialDelaySeconds: 60\n            periodSeconds: 30\n            successThreshold: 1\n            timeoutSeconds: 10\n          lifecycle:\n            preStop:\n              exec:\n                command:\n                - sh\n                - -c\n                - sleep 10\n          resources:\n            limits:\n              cpu: 100m\n              memory: 256Mi\n            requests:\n              cpu: 10m\n              memory: 256Mi\n')),(0,l.kt)("p",null,"Helm \u900f\u904e\u9019\u7a2e\u8a2d\u8a08\u505a\u5230\u4e86 Kubernetes \u539f\u751f\u7121\u6cd5\u7ba1\u7406 ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u7684\u554f\u984c\u3002\u5230\u9019\u908a\u53ef\u4ee5\u4e86\u89e3\u6a21\u677f\u5982\u4f55\u8f49\u8b6f\uff0c\u4f46\u5728\u8f49\u8b6f\u524d\u53ef\u4ee5\u5c0d ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u9032\u884c\u683c\u5f0f\u4e0a\u9a57\u8b49\uff0c\u9a57\u8b49\u6a21\u677f\u4e2d\u7684\u683c\u5f0f\u662f\u5426\u6b63\u78ba\uff0c\u4f46\u6b64\u968e\u6bb5\u7121\u6cd5\u78ba\u4fdd\u8f49\u8b6f\u51fa\u4f86\u7684 Kubernetes \u8cc7\u6e90\u53ef\u88ab\u4f7f\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm lint ./ -f values.yaml \n==> Linting ./\n[INFO] Chart.yaml: icon is recommended\n\n1 chart(s) linted, 0 chart(s) failed\n")),(0,l.kt)("h2",{id:"helm-charts-\u6574\u5408-kubeconform"},"Helm charts \u6574\u5408 Kubeconform"),(0,l.kt)("p",null,"\u7576\u4e00\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u88ab\u5b9a\u7fa9\u597d\u4e4b\u5f8c\uff0c\u61c9\u7576\u9a57\u8b49\u5176\u6a21\u677f\u8f49\u8b6f\u51fa\u4f86 ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u7684\u5b8c\u6574\u6027\u3002",(0,l.kt)("a",{parentName:"p",href:"https://github.com/yannh/kubeconform"},"Kubeconform")," \u662f\u4e00\u500b\u9a57\u8b49\u5de5\u5177 Kubernetes ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u8cc7\u6e90\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u5c07\u5176\u5c0e\u5165 CI \u6d41\u7a0b\u3002"),(0,l.kt)("p",null,"\u672c\u5be6\u9a57\u662f\u7528 ubuntu \u74b0\u5883\u76f4\u63a5\u5b89\u88dd\uff0c\u5176\u5b83\u65b9\u5f0f\u53ef\u53c3\u95b1\u6b64",(0,l.kt)("a",{parentName:"p",href:"https://github.com/yannh/kubeconform#installation"},"\u9023\u7d50")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ wget https://github.com/yannh/kubeconform/releases/download/v0.6.3/kubeconform-linux-amd64.tar.gz\n$ tar xf kubeconform-linux-amd64.tar.gz\n$ sudo mv kubeconform /usr/local/bin\n")),(0,l.kt)("p",null,"\u9a57\u8b49\u65b9\u5f0f\u5f88\u7c21\u55ae\u7684\u4f7f\u7528\uff0c\u53ef\u4ee5\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"helm template")," \u7522\u751f\u51fa\u671f\u671b\u7684\u90e8\u7f72\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\uff0c\u518d\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"Kubeconform")," \u9a57\u8b49\u3002"),(0,l.kt)("p",null,"\u9a57\u8b49\u904e\u7a0b\u6703\u5efa\u8b70\uff0c\u6307\u5b9a Kubernetes \u7248\u672c\u4f86\u9032\u884c\u9a57\u8b49\uff0cKubernetes \u6bcf\u500b\u7248\u672c\u7684 API \u6703\u6709\u6240\u4e0d\u540c\uff0c\u9019\u6a23\u53ef\u4ee5\u660e\u78ba\u77e5\u9053 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u53ef\u4ee5\u5728\u54ea\u500b\u74b0\u5883\u904b\u884c\u3002\u907f\u514d Kubernetes \u5347\u7d1a\u5f8c\u5e36\u4f86\u7684\u707d\u96e3\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm template --skip-tests --kube-version v1.23.0 ./ -f ci/values-analysis.yaml | kubeconform --summary -kubernetes-version 1.23.0\nSummary: 8 resources found parsing stdin - Valid: 8, Invalid: 0, Errors: 0, Skipped: 0\n")),(0,l.kt)("p",null,"\u5982\u679c\u6b64\u6642\uff0c\u60f3\u4f7f\u7528 1.26.0 \u7248\u672c\u7684 Kubernetes \u74b0\u5883\u9a57\u8b49\u6703\u767c\u73fe\u932f\u8aa4\u3002\u9019\u662f\u56e0\u70ba 1.23.0 \u7248\u672c\u652f\u63f4 ",(0,l.kt)("inlineCode",{parentName:"p"},"autoscaling/v2beta1"),"\uff0c\u4f46 1.26.0 \u5b98\u65b9\u8a8d\u70ba\u4ed6\u5df2\u7d93\u53ef\u4ee5\u7a69\u5b9a\u904b\u884c\u6240\u4ee5\u8b8a\u66f4\u70ba ",(0,l.kt)("inlineCode",{parentName:"p"},"autoscaling/v2"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm template --skip-tests --kube-version v1.26.0 ./ -f ci/values-analysis.yaml | kubeconform --summary -kubernetes-version 1.26.0\nstdin - HorizontalPodAutoscaler release-name-web-app failed validation: could not find schema for HorizontalPodAutoscaler\nSummary: 8 resources found parsing stdin - Valid: 7, Invalid: 0, Errors: 1, Skipped: 0\n")),(0,l.kt)("p",null,"\u9019\u9a57\u8b49\u7d50\u679c\u8981\u6709\u66f4\u8a73\u7d30\u7684\u5167\u5bb9\u53ef\u4ee5\u52a0\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"-output")," \u53c3\u6578\u4f86\u6307\u5b9a\u683c\u5f0f\uff0c\u5176\u652f\u63f4\u7684\u6709 json\u3001junit \u8207 tap\uff0c\u800c text \u70ba\u9810\u8a2d "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm template --skip-tests ./ -f ci/values-analysis.yaml | kubeconform -kubernetes-version 1.23.0  -output junit\n<testsuites name="kubeconform" time="1.137183422" tests="8" failures="0" disabled="0" errors="0">\n  <testsuite name="stdin" id="1" tests="8" failures="0" errors="0" disabled="0" skipped="0">\n    <testcase name="release-name-web-app" classname="ConfigMap@v1" time="0"></testcase>\n    <testcase name="default/release-name-web-app" classname="ClusterRole@rbac.authorization.k8s.io/v1" time="0"></testcase>\n    <testcase name="release-name-web-app" classname="ClusterRoleBinding@rbac.authorization.k8s.io/v1" time="0"></testcase>\n    <testcase name="web" classname="ServiceAccount@v1" time="0"></testcase>\n    <testcase name="release-name-web-app" classname="Service@v1" time="0"></testcase>\n    <testcase name="release-name-web-app" classname="Ingress@networking.k8s.io/v1" time="0"></testcase>\n    <testcase name="release-name-web-app" classname="HorizontalPodAutoscaler@autoscaling/v2beta1" time="0"></testcase>\n    <testcase name="release-name-web-app" classname="Deployment@apps/v1" time="0"></testcase>\n  </testsuite>\n</testsuites>\n')),(0,l.kt)("p",null,"\u9019\u908a\u7c21\u6613\u4e86\u4f7f\u7528\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"kubeconform")," \u64cd\u4f5c\uff0c\u9810\u8a2d\u4e0a\u74b0\u5883\u5e38\u5e38\u53ef\u80fd\u6703\u6709\u975e\u539f\u59cb Kubernetes \u8cc7\u6e90\u7684 CRD\uff0c\u5982\u679c\u8981\u505a\u9a57\u8b49\u7684\u8a71\u53ef\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"-ignore-missing-schemas")," \u6389\u6216\u662f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"-schema-location")," \u65b9\u5f0f\u53bb\u505a\u8655\u7406\u9019\u90e8\u5206\u53ef\u4ee5\u53c3\u95b1",(0,l.kt)("a",{parentName:"p",href:"https://github.com/yannh/kubeconform#overriding-schemas-location"},"\u9023\u7d50"),"\u3002"),(0,l.kt)("h2",{id:"helm-charts-\u6574\u5408-kube-score"},"Helm charts \u6574\u5408 kube-score"),(0,l.kt)("p",null,"\u5c0d\u65bc\u9a57\u8b49 ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u5b8c\u6574\u6027\u4f86\u8aaa\u53ef\u80fd\u9084\u4e0d\u5920\uff0c\u5982\u679c\u60f3\u8981\u9032\u968e\u7684\u5c0d\u7269\u4ef6\u8cc7\u6e90\u9032\u884c\u9a57\u8b49\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/zegl/kube-score"},"kube-score")," \u4f86\u5be6\u73fe\uff0c\u5176\u8f38\u51fa\u5167\u5bb9\u6703\u662f\u63a8\u85a6\u53ef\u5be6\u8e10\u7684\u5167\u5bb9\uff0c\u53ef\u80fd\u76f8\u95dc\u65bc\u5b89\u5168\u90e8\u5206\u6216\u662f\u53ef\u9760\u6027\u90e8\u5206\u3002\u540c\u6a23\u7684\u53ef\u4ee5\u5c07\u5176\u5c0e\u5165 CI \u6d41\u7a0b\u4f86\u5f37\u5316 charts \u6240\u8f49\u8b6f\u7269\u4ef6\u662f\u5426\u5920\u5f37\u58ef\u3002"),(0,l.kt)("p",null,"\u672c\u5be6\u9a57\u662f\u7528 ubuntu \u74b0\u5883\u76f4\u63a5\u5b89\u88dd\uff0c\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ wget https://github.com/zegl/kube-score/releases/download/v1.17.0/kube-score_1.17.0_linux_amd64.tar.gz\n$ tar xf kube-score_1.17.0_linux_amd64.tar.gz\n$ sudo mv kube-score /usr/local/bin\n")),(0,l.kt)("p",null,"\u6709\u8208\u8da3\u8005\u53ef\u4ee5\u85c9\u7531",(0,l.kt)("a",{parentName:"p",href:"https://kube-score.com/"},"\u5b98\u65b9\u7db2\u7ad9"),"\u4f4d\u7f6e\u9032\u884c\u9ad4\u9a57\u3002"),(0,l.kt)("p",null,"\u9019\u908a\u540c\u6a23\u7684\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm template")," \u65b9\u5f0f\u7522\u751f ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u8cc7\u6e90\uff0c\u4e26\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"kube-score")," \u9032\u884c\u6383\u63cf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm template --skip-tests --kube-version v1.23.0 ./ -f ci/values-analysis.yaml | kube-score score --kubernetes-version "v1.23" -o ci -\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-ephemeral-storage-request-equals-limit is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment: Pod Topology Spread Constraints\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-memory-requests-equal-limits is ignored\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) Ephemeral Storage limit is not set\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-ports-check is ignored\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) The container is running with a low user ID\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) The container running with a low group ID\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) The pod has a container with a writable root filesystem\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-seccomp-profile is ignored\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) ImagePullPolicy is not set to Always\n[OK] release-name-web-app apps/v1/Deployment\n[CRITICAL] release-name-web-app apps/v1/Deployment: The pod does not have a matching NetworkPolicy\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-resource-requests-equal-limits is ignored\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-cpu-requests-equal-limits is ignored\n[CRITICAL] release-name-web-app apps/v1/Deployment: (web-app) Image with latest tag\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[CRITICAL] release-name-web-app apps/v1/Deployment: No matching PodDisruptionBudget was found\n[WARNING] release-name-web-app apps/v1/Deployment: Deployment does not have a host podAntiAffinity set\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n')),(0,l.kt)("p",null,"\u9019\u908a\u767c\u73fe\u4e00\u4e9b ",(0,l.kt)("inlineCode",{parentName:"p"},"CRITICAL")," \u8a0a\u606f\uff0c\u9019\u8868\u793a ",(0,l.kt)("inlineCode",{parentName:"p"},"kube-score")," \u5efa\u8b70\u4f60\u8981\u505a\u50cf\u662f\u4e0d\u4f7f\u7528 latest \u6620\u50cf\u6a94\u6a19\u7c64\u6216\u662f\u5e0c\u671b\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"PodDisruptionBudget")," \u7684\u7269\u4ef6\u7b49\u3002\u5728 CI \u4e2d\u51fa\u73fe\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"CRITICAL")," \u6703\u662f\u4ee5\u4e0d\u901a\u904e\u6536\u5834\u3002\u5982\u679c\u5047\u8a2d\u5728\u74b0\u5883\u4e0a\u6c92\u6709\u6253\u7b97\u5be6\u73fe ",(0,l.kt)("inlineCode",{parentName:"p"},"PodDisruptionBudget")," \u6216\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"NetworkPolicy")," \u8cc7\u6e90\uff0c\u6211\u5011\u53ef\u4ee5\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"--disable-ignore-checks-annotations")," \u6216\u662f Kubernetes \u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"annotations")," \u6b04\u4f4d\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"kube-score/ignore")," \u4f86\u5be6\u73fe\u5fc5\u9a57\u8b49\u7684\u52d5\u4f5c\uff0c\u5b98\u65b9\u63d0\u4f9b\u7684",(0,l.kt)("a",{parentName:"p",href:"https://github.com/zegl/kube-score/blob/master/README_CHECKS.md"},"\u6e05\u55ae"),"\u3002"),(0,l.kt)("p",null,"\u9019\u908a\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"ci/values-analysis.yaml")," \u591a\u65b0\u589e\u4e86\u4ee5\u4e0b\u7684\u5b9a\u7fa9\u4f86\u6c7a\u7b56 ",(0,l.kt)("inlineCode",{parentName:"p"},"kube-score")," \u8981\u555f\u7528\u54ea\u4e9b\u6aa2\u67e5\u6216\u662f\u95dc\u9589\u6aa2\u67e5\uff0c\u5df2\u95dc\u9589\u4f86\u8aaa\u907f\u958b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"NetworkPolicy"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"securityContext")," \u7684 user \u548c group ID \u6aa2\u67e5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"deploymentAnnotations:\n  kube-score/ignore: pod-networkpolicy,container-security-context-user-group-id,container-security-context-readonlyrootfilesystem,container-ephemeral-storage-request-and-limit,deployment-has-poddisruptionbudget\n  kube-score/enable: container-ports-check\n")),(0,l.kt)("p",null,"\u6700\u5f8c\uff0c\u5728\u9a57\u8b49\u4e00\u6b21\u6c92\u6709\u51fa\u73fe ",(0,l.kt)("inlineCode",{parentName:"p"},"CRITICAL")," \u8b66\u544a\uff0c\u5c31\u53ef\u4ee5\u901a\u904e\u6aa2\u67e5\u3002\u8981\u95dc\u9589\u4ec0\u9ebc\u6aa2\u67e5\uff0c\u9019\u53d6\u6c7a\u65bc\u5718\u968a\u8a2d\u8a08\u7684\u67b6\u69cb\uff0c\u4e5f\u4e0d\u61c9\u7576\u7565\u904e\u4e00\u4e9b\u57fa\u672c\u7684\u6aa2\u67e5\u50cf\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"securityContext")," \u8a2d\u5b9a\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm template --skip-tests --kube-version v1.23.0 ./ -f ci/values-analysis.yaml | kube-score score --kubernetes-version "v1.23" -o ci -\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-resource-requests-equal-limits is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because pod-networkpolicy is ignored\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-security-context-user-group-id is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-security-context-readonlyrootfilesystem is ignored\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-seccomp-profile is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-memory-requests-equal-limits is ignored\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-ephemeral-storage-request-equals-limit is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment: Pod Topology Spread Constraints\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-cpu-requests-equal-limits is ignored\n[OK] release-name-web-app apps/v1/Deployment\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because container-ephemeral-storage-request-and-limit is ignored\n[SKIPPED] release-name-web-app apps/v1/Deployment: Skipped because deployment-has-poddisruptionbudget is ignored\n[WARNING] release-name-web-app apps/v1/Deployment: Deployment does not have a host podAntiAffinity set\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app apps/v1/Deployment\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app autoscaling/v2beta1/HorizontalPodAutoscaler\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app networking.k8s.io/v1/Ingress\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n[OK] release-name-web-app v1/Service\n')),(0,l.kt)("h2",{id:"charts-\u55ae\u5143\u6e2c\u8a66"},"charts \u55ae\u5143\u6e2c\u8a66"),(0,l.kt)("p",null,"\u4e0a\u9762\u9a57\u8b49\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," \u8cc7\u6e90\uff0c\u5982\u679c\u60f3\u66f4\u8981\u5728\u8cbc\u8fd1\u4e00\u9ede\u73fe\u5be6\u53ef\u4ee5\u900f\u904e\u55ae\u5143\u6e2c\u8a66\u65b9\u5f0f\u9a57\u8b49\u8f49\u8b6f\u7684\u7269\u4ef6\u5167\u5bb9\u662f\u4e0d\u662f\u4f60\u671f\u671b\u5728 Kubernets \u4e0a\u904b\u884c\u7684\u5167\u5bb9\u3002\u9019\u908a\u4f7f\u7528 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/helm-unittest/helm-unittest"},"helm-unittest")," \u5957\u4ef6\u4f86\u9032\u884c\u55ae\u5143\u6e2c\u8a66\u3002"),(0,l.kt)("p",null,"\u4ed6\u5c6c\u65bc Helm \u7684\u5957\u4ef6\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm plugin")," \u65b9\u5f0f\u5b89\u88dd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm plugin install https://github.com/helm-unittest/helm-unittest.git\n")),(0,l.kt)("p",null,"\u4e00\u958b\u59cb\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u7684\u76ee\u9304\u4e0b\u5efa\u7acb ",(0,l.kt)("inlineCode",{parentName:"p"},"tests")," \u76ee\u9304\uff0c\u4e26\u628a\u8a72\u76ee\u9304\u65b0\u589e\u81ea ",(0,l.kt)("inlineCode",{parentName:"p"},".helmignore")," \u4e2d\u3002\u8981\u89f8\u767c\u6e2c\u8a66\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm unittest CHART_NAME"),"\u4e0b\u9762\u662f\u4e00\u500b\u6e2c\u8a66\u5b8c\u6210\u7684\u7d50\u679c\uff0c\u9810\u8a2d\u683c\u5f0f\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"XUnit"),"\uff0c\u9019\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"-t")," \u53c3\u6578\u9032\u884c\u66ff\u63db\uff0c\u53ef\u4ee5\u662f JUnit\u3001NUnit \u6216 XUnit\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm unittest web-app/\n\n### Chart [ web-app ] web-app/\n\n PASS  test cluster role        web-app/tests/clusterrole_test.yaml\n PASS  test clusterrolebinding  web-app/tests/clusterrolebinding_test.yaml\n PASS  test configMap   web-app/tests/configmap_test.yaml\n PASS  test deployment  web-app/tests/deployment_test.yaml\n PASS  test service     web-app/tests/service_test.yaml\n PASS  test serviceAccount      web-app/tests/serviceaccount_test.yaml\n\nCharts:      1 passed, 1 total # \u8868\u793a\u4e00\u500b charts \u88ab\u6e2c\u8a66\nTest Suites: 6 passed, 6 total # \u6e2c\u8a66\u7684\u5834\u666f\u6709 6 \u500b\uff0c\u901a\u904e 6 \u500b\nTests:       6 passed, 6 total\nSnapshot:    0 passed, 0 total\nTime:        12.111921ms\n")),(0,l.kt)("p",null,"\u5982\u679c\u8981\u5c07\u7d50\u679c\u8f38\u51fa\u81f3 ",(0,l.kt)("inlineCode",{parentName:"p"},"CI")," \u7684\u7522\u7269\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"-o FILE_NAME")," \u65b9\u5f0f\uff0c\u8f38\u51fa\u7684\u6a94\u6848\u6703\u53d6\u6c7a\u65bc\u5728\u54ea\u500b\u76ee\u9304\u57f7\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"helm unittest"),"\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u500b\u6e2c\u8a66 ",(0,l.kt)("inlineCode",{parentName:"p"},"deployment.yaml")," \u7684\u5167\u5bb9\u3002\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"asserts")," \u4e2d\u7528\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"equal"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"isNotEmpty"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"contains")," \u7b49\u95dc\u9375\u5b57\uff0c\u4f46\u91cd\u9ede\u5728\u65bc ",(0,l.kt)("inlineCode",{parentName:"p"},"path")," \u5176\u5c31\u662f\u7528\u4f86\u5c0d\u61c9\u771f\u5be6\u90e8\u7f72\u8cc7\u6e90\u7684\u6b04\u4f4d\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"path: \u6703\u662f\u53c3\u7167 Kubernetes \u7269\u4ef6\u8cc7\u6e90\u4e0a\u5167\u5bb9\uff0c\u901a\u5e38\u6703\u7cbe\u6e96\u6307\u5411\u67d0\u500b\u7269\u4ef6\u4e2d\u6b04\u4f4d\u3002\u53ef\u4ee5\u60f3\u50cf\u662f\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl get")," \u67d0\u7269\u4ef6\u7136\u5f8c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"jsonpath")," \u4f86\u81ea\u5b9a\u7fa9\u8f38\u51fa\u3002"),(0,l.kt)("li",{parentName:"ul"},"value: \u671f\u671b path \u4e0a\u7684\u503c\uff0c\u4f46\u9019\u901a\u5e38\u7528\u65bc Kubernetes \u4e0a\u7684\u6b04\u4f4d\u6307\u5c0d\u61c9\u4e00\u500b\u503c\u4f7f\u7528\u3002"),(0,l.kt)("li",{parentName:"ul"},"content: \u985e\u4f3c\u65bc path\uff0c\u4f46\u61c9\u7528\u65bc\u591a\u8f38\u51fa\u7684\u5167\u5bb9\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'suite: test deployment\nvalues: # \u6e2c\u8a66\u6642\u8981\u4f7f\u7528\u7684 values yaml\n  - ../ci/values-test.yaml\ntemplates: # \u8981\u88ab\u6e2c\u8a66\u7684\u6a21\u677f\n  - templates/deployment.yaml\n  - templates/configmap.yaml\nrelease: # \u6a21\u64ec charts \u90e8\u7f72\u6642\u7684\u5167\u5bb9\n  name: test-release\n  namespace: test\nchart: # \u6a21\u64ec charts \u7684\u7248\u672c\u548c app \u7248\u672c\n  version:  0.1.0+test\n  appVersion: 1.16.0\ntests:\n  - it: should pass all kinds of assertion\n    template: templates/deployment.yaml\n    documentIndex: 0\n    asserts: \n      - equal:\n          path: metadata.labels["app.kubernetes.io/managed-by"]\n          value: Helm\n      - equal:\n          path: metadata.labels["app.kubernetes.io/name"]\n          value: web-app\n      - equal:\n          path: metadata.annotations["org.cch.com/owner"]\n          value: cch\n      - equal:\n          path: metadata.annotations["org.cch.com/organize"]\n          value: CCH Tech\n      - isNotEmpty:\n          path: spec.template.metadata.annotations["checksum/config"]\n      - equal:\n          path: spec.template.spec.containers[?(@.name == "web-app")].image\n          value: registry.hub.docker.com/cch0124/helm-demo:v2.2.9\n      - equal:\n          path: spec.template.spec.serviceAccountName\n          value: web\n      - matchRegex:\n          path: metadata.name\n          pattern: ^.*-web-app$\n      - contains:\n          path: spec.template.spec.containers[?(@.name == "web-app")].ports\n          content:\n            containerPort: 8080\n            protocol: TCP\n            name: http\n      - notContains:\n          path: spec.template.spec.containers[?(@.name == "web-app")].ports\n          content:\n            containerPort: 80\n      - isNotEmpty:\n          path: spec.template.spec.containers[?(@.name == "web-app")].livenessProbe\n      - isNotEmpty:\n          path: spec.template.spec.containers[?(@.name == "web-app")].readinessProbe\n      - isNotEmpty:\n          path: spec.template.spec.containers[?(@.name == "web-app")].resources\n      - isSubset:\n          path: spec.template.spec.containers[?(@.name == "web-app")].securityContext\n          content:\n            capabilities:\n              drop:\n              - ALL\n            readOnlyRootFilesystem: false\n            allowPrivilegeEscalation: false\n            runAsUser: 185\n            runAsGroup: 185\n      - isNotEmpty:\n          path: spec.template.spec.containers[?(@.name == "web-app")].lifecycle\n      - isSubset:\n          path: spec.template.spec.securityContext\n          content:\n            fsGroup: 185\n            runAsNonRoot: true\n      - isKind:\n          of: Deployment\n      - isAPIVersion:\n          of: apps/v1\n')),(0,l.kt)("p",null,"\u66f4\u591a\u7684\u7d30\u7bc0\u53ef\u4ee5\u53c3\u7167 helm-unittest \u5b98\u65b9",(0,l.kt)("a",{parentName:"p",href:"https://github.com/helm-unittest/helm-unittest/blob/main/DOCUMENT.md"},"\u6587\u4ef6"),"\u3002"),(0,l.kt)("h2",{id:"charts-\u6574\u5408-helm-docs-\u7522\u751f\u6587\u4ef6"},"charts \u6574\u5408 helm-docs \u7522\u751f\u6587\u4ef6"),(0,l.kt)("p",null,"\u662f\u4e00\u500b\u5c07 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u4e2d\u7684\u8cc7\u8a0a\u8f49\u8b6f\u6210 markdown \u6a94\u6848\u7684\u5de5\u5177\u3002\u751f\u6210\u7684\u5167\u5bb9\u5305\u542b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"Chart.yaml")," \u4e2d\u7684\u4e00\u4e9b\u8cc7\u8a0a\u6216\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u4e2d\u5b9a\u7fa9\u7684\u503c\u5167\u5bb9\uff0c\u8a72\u5167\u5bb9\u6703\u4f7f\u7528\u8a3b\u89e3\u4f86\u9032\u884c\u89e3\u6790\u3002"),(0,l.kt)("p",null,"\u8f49\u8b6f markdown \u9019\u6d41\u7a0b\u662f\u5f9e gotemplate \u5be6\u4f5c\uff0c\u76f8\u4f3c\u65bc ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u6a21\u677f\u3002\u9810\u8a2d\u4e0a helm-docs \u6709\u57fa\u672c\u7684\u6a23\u5f0f\u4f86\u505a\u8f49\u8b6f\uff0c\u7576\u7136\u4e5f\u53ef\u4ee5\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"README.md.gotmpl")," \u6a94\u6848\u9032\u884c\u8f49\u8b6f\u5167\u5bb9\u7684\u5b9a\u7fa9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'# {{ template "chart.name" . }}\n\n![Version: {{ .Version }}](https://img.shields.io/badge/Version-{{ .Version | replace "-" "--" }}-informational?style=for-the-badge)\n{{ if .Type }}![Type: {{ .Type }}](https://img.shields.io/badge/Type-{{ .Type }}-informational?style=for-the-badge) {{ end }}\n{{ if .AppVersion }}![AppVersion: {{ .AppVersion }}](https://img.shields.io/badge/AppVersion-{{ .AppVersion | replace "-" "--" }}-informational?style=for-the-badge) {{ end }}\n\n## {{ template "chart.name" . }} Chart Information\n\n\n[Homepage]({{ template "chart.homepage" . }})\n\n{{ template "chart.sourcesSection" . }}\n\n{{ template "chart.maintainersSection" . }}\n\n\n## Description\n\n{{ template "chart.description" . }}\n\n\n{{ template "chart.requirementsSection" . }}\n\n\n{{ template "chart.valuesSection" . }}\n\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helm-docs")," \u7684\u6307\u4ee4\u5141\u8a31\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"-t")," \u6307\u5b9a\u6a21\u677f\u6a94\u6848\u6216\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"-f")," \u6307\u5b9a\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u4e2d\u9810\u8a2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u7b49\uff0c\u4e0b\u65b9\u70ba\u6307\u4ee4\u6240\u63d0\u4f9b\u7684\u53c3\u6578\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm-docs --help\nhelm-docs automatically generates markdown documentation for helm charts from requirements and values files\n\nUsage:\n  helm-docs [flags]\n\nFlags:\n  -b, --badge-style string           badge style to use for charts (default "flat-square")\n  -c, --chart-search-root string     directory to search recursively within for charts (default ".")\n  -g, --chart-to-generate strings    List of charts that will have documentation generated. Comma separated, no space. Empty list - generate for all charts in chart-search-root\n  -u, --document-dependency-values   For charts with dependencies, include the dependency values in the chart values documentation\n  -d, --dry-run                      don\'t actually render any markdown files just print to stdout passed\n  -h, --help                         help for helm-docs\n  -i, --ignore-file string           The filename to use as an ignore file to exclude chart directories (default ".helmdocsignore")\n      --ignore-non-descriptions      ignore values without a comment, this values will not be included in the README\n  -l, --log-level string             Level of logs that should printed, one of (panic, fatal, error, warning, info, debug, trace) (default "info")\n  -o, --output-file string           markdown file path relative to each chart directory to which rendered documentation will be written (default "README.md")  \n  -s, --sort-values-order string     order in which to sort the values table ("alphanum" or "file") (default "alphanum")\n  -t, --template-files strings       gotemplate file paths relative to each chart directory from which documentation will be generated (default [README.md.gotmpl])\n  -f, --values-file string           Path to values file (default "values.yaml")\n      --version                      version for helm-docs\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"helm-docs")," \u4e2d\u53ef\u5b9a\u7fa9\u7684\u8f49\u8b6f\u6a21\u677f\u53ef\u53c3\u8003\u6b64\u5b98\u65b9",(0,l.kt)("a",{parentName:"p",href:"https://github.com/norwoodj/helm-docs#markdown-rendering"},"\u9023\u7d50"),"\uff0c\u5c0d\u65bc\u8f49\u8b6f\u4f86\u8aaa\u6bd4\u8f03\u91cd\u8981\u7684\u53c3\u6578\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"--chart-search-root")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"--template-files")," \u5982\u679c\u5176\u63d0\u4f9b\u7684\u9810\u8a2d\u503c\u4e0d\u7b26\u5408\u5834\u666f\u8a2d\u8a08\u53ef\u4ee5\u9032\u884c\u9748\u6d3b\u4e0a\u7684\u8abf\u6574\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u662f\u5b9a\u7fa9\u5f8c\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"READEM.md.gotmpl"),"\uff0c\u4f7f\u7528\u4e0a\u6bd4\u8f03\u9ebb\u7169\u7684\u90e8\u5206\u5c31\u662f gotemplate \u7684\u8a9e\u6cd5\uff0c\u5176\u5b83\u57fa\u672c\u4e0a\u770b\u5b98\u65b9\u7684\u6587\u6a94\u5167\u5bb9\u5c31\u53ef\u4ee5\u7d44\u5408\u51fa\u81ea\u5df1\u60f3\u8981\u7684\u683c\u5f0f\u5167\u5bb9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'# {{ template "chart.name" . }}\n\n![Version: {{ .Version }}](https://img.shields.io/badge/Version-{{ .Version | replace "-" "--" }}-informational?style=for-the-badge)\n{{ if .Type }}![Type: {{ .Type }}](https://img.shields.io/badge/Type-{{ .Type }}-informational?style=for-the-badge) {{ end }}\n{{ if .AppVersion }}![AppVersion: {{ .AppVersion }}](https://img.shields.io/badge/AppVersion-{{ .AppVersion | replace "-" "--" }}-informational?style=for-the-badge) {{ end }}\n\n## {{ template "chart.name" . }} Chart Information\n\n\n[Homepage]({{ template "chart.homepage" . }})\n\n{{ template "chart.sourcesSection" . }}\n\n{{ template "chart.maintainersSection" . }}\n\n\n## Description\n\n{{ template "chart.description" . }}\n\n\n{{ template "chart.requirementsSection" . }}\n\n\n{{ template "chart.valuesSection" . }}\n\n')),(0,l.kt)("p",null,"\u4e0a\u8ff0\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"READEM.md.gotmpl")," \u6bd4\u8f03\u91cd\u8981\u7684\u5167\u5bb9\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u4e2d\u6240\u5b9a\u7fa9\u7684\u503c\uff0c\u56e0\u70ba\u9019\u662f\u7d66\u4f7f\u7528\u6216\u662f\u7ba1\u7406 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u7684\u4eba\u4f86\u505a\u4e00\u500b\u4f9d\u64da\u7684\u53c3\u8003\u3002\u96d6\u7136\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"chart.valuesSection")," \u6a21\u677f\u4f86\u89e3\u6790 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u5167\u5bb9\uff0c\u4f46\u5982\u904e\u6c92\u91dd\u5c0d ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u9032\u884c\u8655\u7406\uff0c\u5247\u8a72\u6a21\u677f\u4e5f\u662f\u6c92\u610f\u7fa9\u7684\u3002\u90a3\u8981\u5982\u4f55\u5b9a\u7fa9\u6709\u50f9\u503c\u7684\u5167\u5bb9\u5462\uff0c\u4e0b\u9762\u5c31\u4f86\u9032\u884c\u8aaa\u660e\u5427\u3002"),(0,l.kt)("p",null,"\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"image")," \u7d50\u69cb\u4f86\u8aaa\uff0c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u4e2d\u5b9a\u7fa9\u4e86\u4ee5\u4e0b\u5167\u5bb9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'image:\n  # -- Image registry\n  repository: registry.hub.docker.com/cch0124/helm-demo\n  # -- Image pull policy\n  pullPolicy: IfNotPresent\n  # -- Overrides the image tag whose default is the chart appVersion.\n  tag: "latest"\n')),(0,l.kt)("p",null,"\u8a72\u5167\u5bb9\u4e0a\u5982\u679c\u8981\u8b93\u6b04\u4f4d\u6709\u63cf\u8ff0\uff0c\u5247\u53ef\u4ee5\u5728\u8a72\u6b04\u4f4d\u4e0a\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"# --")," \u958b\u982d\u4e26\u5411\u5f8c\u586b\u5beb\u8981\u63cf\u8ff0\u7684\u8a3b\u89e3\uff0c\u6700\u5f8c\u8f49\u8b6f\u7d50\u679c\u6703\u5982\u4e0b"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Key"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"image.pullPolicy"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'"IfNotPresent"')),(0,l.kt)("td",{parentName:"tr",align:null},"Image pull policy")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"image.repository"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'"registry.hub.docker.com/cch0124/helm-demo"')),(0,l.kt)("td",{parentName:"tr",align:null},"Image registry")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"image.tag"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'"latest"')),(0,l.kt)("td",{parentName:"tr",align:null},"Overrides the image tag whose default is the chart appVersion.")))),(0,l.kt)("p",null,"\u5982\u679c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u662f\u6c92\u6709\u64b0\u5beb\u8a3b\u89e3\u683c\u5f0f\uff0c\u5247\u6700\u5f8c\u8449\u7bc0\u9ede\u6703\u88ab\u8f49\u8b6f\u51fa\u4f86\uff0c\u4f46\u662f\u63cf\u8ff0\u90e8\u5206\u5c31\u6709\u4e9b\u8a31\u7a7a\u865b\u4e86\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"rbac:\n  create: true\n")),(0,l.kt)("p",null,"\u8f49\u8b6f\u7d50\u679c\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Key"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"rbac.create"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"true")),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"\u5982\u679c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u7684\u6839\u7bc0\u9ede\u6b04\u4f4d\u64b0\u5beb\u8a3b\u89e3\uff0c\u5247\u8449\u7bc0\u9ede\u4e0d\u6703\u88ab\u8f49\u8b6f\uff0c\u6703\u4ee5\u6839\u7bc0\u9ede\u7269\u4ef6\u5448\u73fe\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# -- Resource requests and limits for the application. Ref [kubernetes doc manage-resources-containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)\nresources:\n  limits:\n    cpu: 100m\n    memory: 256Mi\n  requests:\n    cpu: 10m\n    memory: 256Mi\n")),(0,l.kt)("p",null,"\u8f49\u8b6f\u7d50\u679c\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Key"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"resources"),(0,l.kt)("td",{parentName:"tr",align:null},"object"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'{"limits":{"cpu":"100m","memory":"256Mi"},"requests":{"cpu":"10m","memory":"256Mi"}}')),(0,l.kt)("td",{parentName:"tr",align:null},"Resource requests and limits for the application. Ref ",(0,l.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"},"kubernetes doc manage-resources-containers"))))),(0,l.kt)("p",null,"\u5982\u679c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u7684\u6839\u7bc0\u9ede\u548c\u8449\u7bc0\u9ede\u5b9a\u7fa9\u8a3b\u89e3\u5982\u4e0b\uff0c\u5247\u8449\u7bc0\u9ede\u6709\u88ab\u8a3b\u89e3\u6703\u88ab\u8f49\u8b6f\uff0c\u5426\u5247\u4e0d\u6703\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# -- Configure the healthcheck for the application\nlivenessProbe:\n  httpGet:\n    # -- This is the liveness check endpoint. Can not overrid.\n    path: /q/health/live\n    port: http\n    scheme: HTTP\n  # @default -- Number of seconds after the container has started before startup, liveness or readiness probes are initiated. \n  initialDelaySeconds: 60\n  # @default -- How often (in seconds) to perform the probe.\n  periodSeconds: 30\n  # @default -- Minimum consecutive successes for the probe to be considered successful after having failed.\n  successThreshold: 1\n  # @default -- Number of seconds after which the probe times out. Defaults to 1 second. Minimum value is 1.\n  timeoutSeconds: 10\n")),(0,l.kt)("p",null,"\u8f49\u8b6f\u7d50\u679c\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Key"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"livenessProbe"),(0,l.kt)("td",{parentName:"tr",align:null},"object"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'{"httpGet":{"path":"/q/health/live","port":"http","scheme":"HTTP"},"initialDelaySeconds":60,"periodSeconds":30,"successThreshold":1,"timeoutSeconds":10}')),(0,l.kt)("td",{parentName:"tr",align:null},"Configure the healthcheck for the application")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"livenessProbe.httpGet.path"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},'"/q/health/live"')),(0,l.kt)("td",{parentName:"tr",align:null},"This is the liveness check endpoint. Can not overrid.")))),(0,l.kt)("p",null,"\u5176\u9084\u63d0\u4f9b ",(0,l.kt)("inlineCode",{parentName:"p"},"@default"),"\u3001\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"@ignored")," \u7b49\u9078\u9805"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@default")," \u5982\u679c\u4e0d\u60f3\u5305\u542b\u5728 values.yaml \u4e2d\u7684\u9810\u8a2d\u503c\uff0c\u6216\u662f\u4e00\u4e9b\u8a08\u7b97\u7684\u503c\u53ef\u4ee5\u4f7f\u7528"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"@ignored")," \u5ffd\u7565\u67d0\u4e9b\u503c")),(0,l.kt)("p",null,"\u6574\u9ad4\u4f86\u8aaa\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm-docs")," \u7522\u751f\u4e00\u500b\u53ef\u8b80\u6027\u7684\u6587\u4ef6\u6a94\u6848\uff0c\u5728\u67d0\u7a2e\u7a0b\u5ea6\u4e0a\u53ef\u4ee5\u5354\u52a9\u90e8\u7f72\u6216\u662f\u4ea4\u63a5\u3002\u4f46\u5177\u9ad4\u8981\u5982\u4f55\u5448\u73fe\u60f3\u8981\u7684\u5167\u5bb9\u5247\u53d6\u6c7a\u65bc\u5718\u968a\u7684\u5171\u8b58\u3002\u672c\u6587\u7ae0\u7bc4\u4f8b\u7684\u7d50\u679c\u53ef\u4ee5\u81f3\u6b64",(0,l.kt)("a",{parentName:"p",href:"https://github.com/CCH0124/quarkus-demo/blob/main/helm-demo/helm-chart/web-app/README.md"},"\u9023\u7d50")),(0,l.kt)("h2",{id:"\u6253\u5305-charts-\u81f3-dockerhub"},"\u6253\u5305 charts \u81f3 DockerHub"),(0,l.kt)("h3",{id:"\u6253\u5305-charts"},"\u6253\u5305 charts"),(0,l.kt)("p",null,"\u5207\u63db\u76ee\u9304\u81f3 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u4e26\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm package")," \u5c0d ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u9032\u884c\u6253\u5305\uff0c\u57f7\u884c\u5f8c\u7576\u524d\u76ee\u9304\u6703\u6709\u4e00\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"CHART_NAME-VERSION.tgz"),"  \u6a94\u6848\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm package --version 0.0.1 ./\n")),(0,l.kt)("h3",{id:"\u767b\u5165-docker-hub-\u4e26\u63a8\u9001"},"\u767b\u5165 Docker Hub \u4e26\u63a8\u9001"),(0,l.kt)("p",null,"\u767b\u5165\u90e8\u5206\u4f7f\u7528 Docker Hub \u7684 Personal Access Token (PAT) \u9032\u884c\uff0c\u4e5f\u63a8\u85a6\u4f7f\u7528\u6b64\u65b9\u5f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ export PAT=PERSONAL_ACCESS_TOKEN\n$ export USERNAME=LOGIN_USERNAME\n$ echo $PAT | docker login -u $USERNAME --password-stdin\n")),(0,l.kt)("p",null,"\u63a8\u9001 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u81f3 Docker Hub\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm push")," \u4e26\u6307\u5b9a\u8981\u63a8\u9001\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u548c\u63a8\u9001\u76ee\u6a19\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm push web-app-0.0.1.tgz oci://registry-1.docker.io/cch0124\nPushed: registry-1.docker.io/cch0124/web-app:0.0.1\nDigest: sha256:10b324b17dc620974f715fd44e6743dbd068a6e0487d496a76d2781c81184199\n")),(0,l.kt)("h2",{id:"\u90e8\u7f72\u8207\u64cd\u4f5c-helm-charts"},"\u90e8\u7f72\u8207\u64cd\u4f5c Helm charts"),(0,l.kt)("h3",{id:"\u90e8\u7f72"},"\u90e8\u7f72"),(0,l.kt)("p",null,"\u4e0a\u500b\u7ae0\u7bc0\u5df2\u7d93\u5c07 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u63a8\u9001\u81f3 Docker Hub \u63a5\u8457\u5c07\u4f7f\u7528\u5b83\u4f86\u62c9\u53d6 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u4e26\u90e8\u7f72\u81f3\u6a21\u64ec\u7684 Kubernetes \u74b0\u5883\u3002"),(0,l.kt)("p",null,"\u90e8\u7f72\u4e4b\u524d\uff0c\u53ef\u4ee5\u85c9\u7531 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm show")," \u4f86\u9032\u884c\u4e00\u4e9b\u8cc7\u8a0a\u67e5\u770b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b charts \u6240\u6709\u8a0a\u606f\n$ helm show all oci://registry-1.docker.io/cch0124/web-app --version 0.0.1\n")),(0,l.kt)("p",null,"\u76f4\u63a5\u9032\u884c\u90e8\u7f72\uff0c\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"helm install"),"\uff0c\u9810\u8a2d\u70ba ",(0,l.kt)("inlineCode",{parentName:"p"},"default")," \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"namespace"),"\uff0c\u4e0b\u9762\u8cc7\u8a0a\u70ba\u90e8\u7f72\u5f8c\u8cc7\u6599\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm install web-app oci://registry-1.docker.io/cch0124/web-app --version 0.0.1\nPulled: registry-1.docker.io/cch0124/web-app:0.0.1\nDigest: sha256:10b324b17dc620974f715fd44e6743dbd068a6e0487d496a76d2781c81184199\nNAME: web-app\nLAST DEPLOYED: Mon Sep 11 20:57:10 2023\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\n1. Get the application URL by running these commands:\n  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=web-app,app.kubernetes.io/instance=web-app" -o jsonpath="{.items[0].metadata.name}")\n  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")\n  echo "Visit http://127.0.0.1:8080 to use your application"\n  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT\n')),(0,l.kt)("p",null,"\u9a57\u8b49\u90e8\u7f72\u7d50\u679c\u8207\u61c9\u7528\u7a0b\u5f0f\u6e2c\u8a66 API\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u9a57\u8b49\u90e8\u7f72")),(0,l.kt)("p",null,"\u5c0d\u65bc Helm \u4f86\u8aaa\u5b83\u662f\u6709 namespace \u6982\u5ff5\uff0c\u56e0\u6b64\u5728\u64cd\u4f5c\u6642\u9808\u5e36 ",(0,l.kt)("inlineCode",{parentName:"p"},"namespace"),"\uff0c\u5f9e ",(0,l.kt)("inlineCode",{parentName:"p"},"STATUS")," \u6b04\u4f4d\u53ef\u4ee5\u770b\u5230\u662f\u6210\u529f\u90e8\u7f72\u7684\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm list \nNAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION\nweb-app default         1               2023-09-11 20:57:10.735141112 +0800 CST deployed        web-app-0.0.1   1.16.0     \n")),(0,l.kt)("p",null,"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl get")," \u8cc7\u6e90\u9a57\u8b49\u662f\u5426\u6709\u6b63\u5e38\u904b\u884c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get pods \nNAME                       READY   STATUS    RESTARTS   AGE\nweb-app-69d997c6ff-wvbwd   1/1     Running   0          3m18s\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u6e2c\u8a66 API")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl run mycurlpod --image=curlimages/curl -i --tty -- sh\n$ curl -XGET http://web-app.default.svc.cluster.local:8080/hello\nHello from RESTEasy Reactive\n")),(0,l.kt)("h3",{id:"\u66f4\u65b0-helm-chart"},"\u66f4\u65b0 Helm chart"),(0,l.kt)("p",null,"\u4e0a\u500b\u6b65\u9a5f\u5728\u90e8\u7f72\u6642\uff0c\u6c92\u6709\u90e8\u7f72\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"ingress"),"\uff0c\u9019\u6642\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm upgrade")," \u9032\u884c\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u70ba\u4e00\u500b\u932f\u8aa4\u7684\u66f4\u65b0\uff0c\u5c0e\u81f4\u6700\u5f8c ",(0,l.kt)("inlineCode",{parentName:"p"},"STATUS")," \u70ba ",(0,l.kt)("inlineCode",{parentName:"p"},"failed"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm upgrade web-app oci://registry-1.docker.io/cch0124/web-app --version 0.0.1 --set ingress.enabled=true --set ingress.hosts[0].host=helm-demo.cch.com --set ingress.hosts[0].paths[0].pathType=Prefix\nPulled: registry-1.docker.io/cch0124/web-app:0.0.1\nDigest: sha256:10b324b17dc620974f715fd44e6743dbd068a6e0487d496a76d2781c81184199\nError: UPGRADE FAILED: failed to create resource: Ingress.extensions "web-app" is invalid: spec.rules[0].http.paths[0].path: Invalid value: "": must be an absolute path\n$ helm list\nNAME    NAMESPACE       REVISION        UPDATED                                 STATUS  CHART           APP VERSION\nweb-app default         2               2023-09-11 21:18:27.328839062 +0800 CST failed  web-app-0.0.1   1.16.0 \n')),(0,l.kt)("p",null,"\u4fee\u6b63\u5f8c\uff0c\u5df2\u7d93\u6210\u529f\u66f4\u65b0\u4e00\u500b\u7248\u672c\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"REVISION")," \u8b8a\u70ba 3\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"ingress")," \u8cc7\u6e90\u4e5f\u88ab\u66f4\u65b0\u90e8\u7f72\u3002\u5728\u505a\u66f4\u65b0\u6642\u4e5f\u63a8\u85a6\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"--atomic")," \u53c3\u6578\uff0c\u9019\u53ef\u5e6b\u52a9 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u66f4\u65b0\u5931\u6557\u5f8c\u53ef\u4ee5\u9032\u884c\u9000\u56de\u4e0a\u4e00\u500b\u7248\u672c\u3002\u9019\u908a\u4f7f\u7528\u7684\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"--set")," \u65b9\u5f0f\u540c\u6642\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"-f")," \u4f86\u6307\u5b9a\u8981\u8f49\u8b6f\u6a21\u677f\u7684\u503c\uff0c\u4ee5\u512a\u5148\u9806\u5e8f\u4f86\u8aaa ",(0,l.kt)("inlineCode",{parentName:"p"},"--set")," \u70ba\u6700\u9ad8\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm upgrade web-app oci://registry-1.docker.io/cch0124/web-app --version 0.0.1 --set ingress.enabled=true --set ingress.hosts[0].host=helm-demo.cch.com --set ingress.hosts[0].paths[0].pathType=Prefix --set ingress.hosts[0].paths[0].path=/ --atomic\nPulled: registry-1.docker.io/cch0124/web-app:0.0.1\nDigest: sha256:10b324b17dc620974f715fd44e6743dbd068a6e0487d496a76d2781c81184199\nRelease "web-app" has been upgraded. Happy Helming!\nNAME: web-app\nLAST DEPLOYED: Mon Sep 11 21:21:14 2023\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 3\nTEST SUITE: None\nNOTES:\n1. Get the application URL by running these commands:\n  http://helm-demo.cch.com/\n')),(0,l.kt)("p",null,"\u66f4\u65b0\u5f8c\u6240\u5efa\u7acb\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"ingress"),"\u3002\u540c\u6642\u5728\u5916\u90e8\u53ef\u4ee5\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"curl")," \u5b58\u53d6\u670d\u52d9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ kubectl get ingress\nNAME      CLASS     HOSTS               ADDRESS                 PORTS   AGE\nweb-app   traefik   helm-demo.cch.com   172.20.0.2,172.20.0.3   80      84s\n$ curl http://helm-demo.cch.com:8080/cluster/namespace \n["default","kube-system","kube-public","kube-node-lease"]\n')),(0,l.kt)("h3",{id:"\u56de\u6efe-charts"},"\u56de\u6efe charts"),(0,l.kt)("p",null,"\u4e0a\u500b\u6b65\u9a5f\u66b4\u9732\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"API")," \u81f3 Kubernetes \u96c6\u7fa4\u5916\uff0c\u5982\u679c\u60f3\u8981\u8b93\u5176\u56de\u5230\u7b2c\u4e00\u6b21\u7121 ",(0,l.kt)("inlineCode",{parentName:"p"},"ingress")," \u72c0\u614b\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm rollback")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm rollback web-app \n1  (App: 1.16.0, Chart: web-app-0.0.1)  2  (App: 1.16.0, Chart: web-app-0.0.1)  3  (App: 1.16.0, Chart: web-app-0.0.1)  \n")),(0,l.kt)("p",null,"\u6b64\u6642\u6703\u591a\u4e00\u500b\u7248\u672c\uff0c\u8a73\u7d30\u7684\u8cc7\u8a0a\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"helm history"),"\uff0c\u4e14 ",(0,l.kt)("inlineCode",{parentName:"p"},"ingress")," \u4e5f\u56de\u5230\u7b2c\u4e00\u7248\u672c\u72c0\u614b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ helm history web-app\nREVISION        UPDATED                         STATUS          CHART           APP VERSION     DESCRIPTION                                                                                                                                                                \n1               Mon Sep 11 20:57:10 2023        superseded      web-app-0.0.1   1.16.0          Install complete                                                                                                                                                           \n2               Mon Sep 11 21:18:27 2023        failed          web-app-0.0.1   1.16.0          Upgrade "web-app" failed: failed to create resource: Ingress.extensions "web-app" is invalid: spec.rules[0].http.paths[0].path: Invalid value: "": must be an absolute path\n3               Mon Sep 11 21:21:14 2023        superseded      web-app-0.0.1   1.16.0          Upgrade complete                                                                                                                                                           \n4               Mon Sep 11 21:31:32 2023        deployed        web-app-0.0.1   1.16.0          Rollback to 1\n')),(0,l.kt)("p",null,"\u9a57\u8b49\u7d50\u679c\uff0c\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'$ kubectl get ingress\nNo resources found in default namespace.\n$ kubectl exec mycurlpod  -it /bin/sh\n~ $ curl http://web-app.default.svc.cluster.local:8080/pod/list/name?namespace=default\n["web-app-69d997c6ff-wvbwd","mycurlpod"]\n~ $ curl http://web-app.default.svc.cluster.local:8080/pod/list/name?namespace=kube-system\n["helm-install-traefik-crd-jgf8d","helm-install-traefik-hpt7l","svclb-traefik-c047adea-n9grs","traefik-6468fd4675-v56h5","svclb-traefik-c047adea-8phnq","local-path-provisioner-5f8bbd68f9-wcptd","coredns-5cfbb9f57c-ljsrl","metrics-server-d8ccb79c9-fcvc9"]\n')),(0,l.kt)("p",null,"\u6700\u5f8c\u88dc\u5145 ",(0,l.kt)("inlineCode",{parentName:"p"},".helmignore"),"\uff0c\u5c07 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u6253\u5305\u6642\u8acb\u8003\u616e\u628a\u654f\u611f\u8cc7\u6599\u5ffd\u7565\uff0c\u907f\u514d\u6a5f\u5bc6\u5916\u6d29\u3002"),(0,l.kt)("p",null,"\u5230\u9019\u908a\u8a8d\u8b58\u4e86 Helm \u7684\u6982\u5ff5\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Chart")," \u4e00\u500b\u53ef\u4ee5\u90e8\u7f72\u5728 K8s Cluster \u7684\u6a94\u6848"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Template")," \u7d44\u6210 Kubernetes \u8cc7\u6e90"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Values")," Kubernetes \u8cc7\u6e90\u53c3\u6578\u5316"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Release")," Kubernetes Cluster \u4e2d\u90e8\u7f72\u7684\u5305"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Push")," \u5c07 Chart \u6a94\u4e1f\u7f6e\u5009\u5eab"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Install")," \u5b89\u88dd\u4e00\u500b charts"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Upgrade")," \u66f4\u6539 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u73fe\u6709\u7248\u672c"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Rollback")," \u56de\u5230\u4ee5\u524d\u90e8\u7f72\u7684\u67d0\u4e00\u7248\u672c")),(0,l.kt)("h2",{id:"\u7e3d\u7d50"},"\u7e3d\u7d50"),(0,l.kt)("p",null,"Helm \u662f\u4e00\u500b\u53ef\u4ee5\u89e3\u6c7a Kubernetes \u90e8\u7f72\u8cc7\u6e90\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4f46\u5c0d\u65bc ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u7684\u6a21\u677f\u5728\u64b0\u5beb\u6642\u5b78\u7fd2\u66f2\u7dda\u6703\u6bd4\u8f03\u9ad8\u4e00\u4e9b\uff0c\u7562\u7adf\u8981\u4e86\u89e3 gotemplate\u3002\u800c ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u4e5f\u61c9\u8a72\u88ab\u9a57\u8b49\u6216\u662f\u6383\u63cf\u4f86\u63d0\u9ad8\u53ef\u7528\u6027\u548c\u5b89\u5168\u6027\uff0c\u4f86\u9a57\u8b49\u4f60\u505a\u4e86\u4ec0\u9ebc\u548c\u4fdd\u8b77 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts"),"\u3002\u800c ",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u53e6\u4e00\u500b\u91cd\u8981\u7684\u662f\u6587\u4ef6\uff0c\u6709\u597d\u7684\u6587\u4ef6\u53ef\u4ee5\u4f7f\u5f97\u7ba1\u7406\u4e0a\u66f4\u52a0\u8f15\u9b06\u3002\u6b64\u6587\u7ae0\u6240\u63d0\u5230\u7684\u5de5\u5177\u4e5f\u4e0d\u662f\u552f\u4e00\uff0c\u6bcf\u500b\u5718\u968a\u7684\u4f7f\u7528\u90fd\u6709\u81ea\u5df1\u9078\u64c7\uff0c\u4f46\u6700\u5f8c\u7684\u76ee\u7684\u90fd\u662f\u8981\u4fdd\u8b77 ",(0,l.kt)("inlineCode",{parentName:"p"},"charts"),"\u3002"),(0,l.kt)("p",null,"\u53e6\u4e00\u65b9\u9762\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"charts")," \u53ef\u4ee5\u88ab\u7248\u63a7\uff0c\u4e5f\u53ef\u4ee5\u91dd\u5c0d\u6bcf\u500b\u74b0\u5883\u4f7f\u7528\u4e0d\u540c\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," \u4f86\u505a\u8f49\u8b6f\uff0c\u6e1b\u5c11\u4e86\u7ba1\u7406\u591a\u74b0\u5883\u7684\u8cc7\u6e90\uff0c\u540c\u6642\u5c0d\u65bc\u73fe\u4eca\u7684 GitOps \u6982\u5ff5\u4f86\u8aaa\u53ef\u4ee5\u505a\u4e00\u500b\u5f88\u597d\u7684\u6574\u5408\u3002"))}c.isMDXComponent=!0}}]);