"use strict";(self.webpackChunknew_infra_labs_docs=self.webpackChunknew_infra_labs_docs||[]).push([[6700],{3905:(e,a,n)=>{n.d(a,{Zo:()=>c,kt:()=>k});var t=n(7294);function l(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){l(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,t,l=function(e,a){if(null==e)return{};var n,t,l={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],a.indexOf(n)>=0||(l[n]=e[n]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)n=r[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var i=t.createContext({}),p=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):o(o({},a),e)),n},c=function(e){var a=p(e.components);return t.createElement(i.Provider,{value:a},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=l,k=u["".concat(i,".").concat(m)]||u[m]||d[m]||r;return n?t.createElement(k,o(o({ref:a},c),{},{components:n})):t.createElement(k,o({ref:a},c))}));function k(e,a){var n=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[u]="string"==typeof e?e:l,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2483:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var t=n(7462),l=(n(7294),n(3905));const r={},o="Infra Labs OpenStack Deployment",s={unversionedId:"admin/openstack_operation",id:"admin/openstack_operation",title:"Infra Labs OpenStack Deployment",description:"Infra Labs \u4f7f\u7528 Ansible Vault \u52a0\u5bc6\u542b\u6709\u6a5f\u654f\u8cc7\u8a0a\u7684\u6587\u4ef6\uff0c\u65b0\u9032\u7ba1\u7406\u54e1\u5982\u9700\u64cd\u4f5c\u8acb\u8a62\u554f Vault \u5bc6\u78bc\u3002",source:"@site/docs/admin/openstack_operation.md",sourceDirName:"admin",slug:"/admin/openstack_operation",permalink:"/docs/admin/openstack_operation",draft:!1,editUrl:"https://github.com/cloud-native-taiwan/Infra-Labs-Docs/tree/main/docs/admin/openstack_operation.md",tags:[],version:"current",frontMatter:{},sidebar:"architecture",previous:{title:"Image Build and Tagging",permalink:"/docs/admin/image_build"}},i={},p=[{value:"\u524d\u8a00",id:"introduction",level:2},{value:"\u5b89\u88dd Kolla-Ansible",id:"install",level:2},{value:"\u5347\u7d1a OpenStack \u7248\u672c",id:"upgrade",level:2},{value:"\u65b0\u589e/\u79fb\u9664\u7bc0\u9ede",id:"adding-and-removing-hosts",level:2}],c={toc:p};function u(e){let{components:a,...n}=e;return(0,l.kt)("wrapper",(0,t.Z)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"infra-labs-openstack-deployment"},"Infra Labs OpenStack Deployment"),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Infra Labs \u4f7f\u7528 Ansible Vault \u52a0\u5bc6\u542b\u6709\u6a5f\u654f\u8cc7\u8a0a\u7684\u6587\u4ef6\uff0c\u65b0\u9032\u7ba1\u7406\u54e1\u5982\u9700\u64cd\u4f5c\u8acb\u8a62\u554f Vault \u5bc6\u78bc\u3002")),(0,l.kt)("h2",{id:"introduction"},"\u524d\u8a00"),(0,l.kt)("p",null,"\u672c\u7bc7\u5c07\u6703\u4ecb\u7d39\u5982\u4f55\u90e8\u7f72 Infra Labs \u63d0\u4f9b IaaS \u7684 OpenStack \u90e8\u5206\u3002"),(0,l.kt)("p",null,"Infra Labs \u4f7f\u7528 OpenStack Kolla-Ansible \u9032\u884c OpenStack \u90e8\u7f72\uff0c\u4e26\u4e14\u5c0d\u5176\u4e2d\u7684\u7a0b\u5f0f\u78bc\u6709\u505a\u4e9b\u8a31\u7684\u6539\u52d5\u3002"),(0,l.kt)("h2",{id:"install"},"\u5b89\u88dd Kolla-Ansible"),(0,l.kt)("p",null,"Infra Labs \u76ee\u524d\u4f7f\u7528\u7684 Kolla-Ansible \u6709\u9032\u884c\u4e9b\u8a31\u66f4\u52d5\uff0c\u672c\u6bb5\u5c07\u4ecb\u7d39\u5982\u4f55\u5957\u7528\u66f4\u52d5\u4e26\u4e14\u5b89\u88dd Kolla-Ansible\u3002"),(0,l.kt)("p",null,"\u66f4\u52d5\u8207 Kolla-Ansible \u8a2d\u5b9a\u6a94\u63a5\u653e\u7f6e\u65bc ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/cloud-native-taiwan/infra-labs-kolla-ansible"},"infra-labs-kolla-ansible repository")),(0,l.kt)("p",null,"\u66f4\u52d5\u70ba git diff \u6a94\u6848\uff0c\u8981\u5957\u7528\u975e\u5e38\u7c21\u55ae\uff0c\u4ee5\u4e0b\u70ba\u4e0b\u8f09 Kolla-Ansible\u3001Infra Labs \u66f4\u52d5\uff0c\u4ee5\u53ca\u5957\u7528\u66f4\u52d5\u6240\u9700\u8981\u7684\u6307\u4ee4\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/openstack/kolla-ansible.git\ngit clone git@github.com:cloud-native-taiwan/infra-labs-kolla-ansible.git\n\ncd kolla-ansible\ngit apply ../infra-labs-kolla-ansible/changes.diff\n")),(0,l.kt)("p",null,"\u63a5\u4e0b\u4f86\u9700\u8981\u5b89\u88dd Kolla-Ansible\uff0c\u53ef\u4ee5\u7a0d\u5fae\u53c3\u8003",(0,l.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html"},"\u5b98\u65b9\u6587\u4ef6")," \u9032\u884c\u4e00\u4e9b\u524d\u7f6e\u4f5c\u696d\u3002"),(0,l.kt)("p",null,"\u63a8\u85a6\u5c07\u5176\u5b89\u88dd\u81f3 Python virtualenv \u800c\u975e\u7cfb\u7d71\u74b0\u5883\uff0c\u4ee5\u4e0b\u6307\u4ee4\u9808\u65bc kolla-ansible \u8cc7\u6599\u593e\u4e0b\u57f7\u884c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pip install -r requirenments.txt\npip install 'ansible>=6,<8'\n\npip install .\n\nkolla-ansible install-deps\n")),(0,l.kt)("h2",{id:"upgrade"},"\u5347\u7d1a OpenStack \u7248\u672c"),(0,l.kt)("p",null,"\u5347\u7d1a OpenStack \u7248\u672c\u524d\uff0c\u8acb\u67e5\u770b ",(0,l.kt)("a",{parentName:"p",href:"https://docs.openstack.org/releasenotes/kolla-ansible/unreleased.html"},"Kolla-Ansible Release Notes"),"\u3002\u5728 Upgrade Notes \u7684\u90e8\u5206\u901a\u5e38\u6709\u5347\u7d1a\u76f8\u95dc\u7684\u91cd\u8981\u8cc7\u8a0a\u3002"),(0,l.kt)("p",null,"\u63a5\u4e0b\u4f86\u6aa2\u67e5 Kolla-Ansible repo \u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"etc/kolla/globals.yml")," \u5c0d\u6bd4\u4e0a\u4e00\u500b\u7248\u672c\u662f\u5426\u6709\u589e\u52a0\u91cd\u8981\u8a2d\u5b9a\uff0c\u5982\u6709\uff0c\u5c07\u65b0\u7684\u8a2d\u5b9a\u52a0\u5165\u81f3 ",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")),(0,l.kt)("p",null,"\u4e0b\u4e00\u6b65\u66f4\u65b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," \u4e2d\u7684\u7248\u672c\u8cc7\u8a0a\uff0c\u5c0d\u61c9\u81f3 Kolla image \u7684 tag"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'openstack_release: "<image_tag>"\n')),(0,l.kt)("p",null,"\u6709\u6642\u66f4\u65b0\u7684\u6642\u5019\u6709\u65b0\u7684\u5bc6\u78bc\u7522\u751f\uff0c\u6b64\u6642\u9700\u8981\u7522\u751f\u5efa\u7acb\u7684\u5bc6\u78bc\uff0c\u4ee5\u4e0b\u70ba\u6307\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-vault decrypt /etc/kolla/passwords.yml\n\ncp /etc/kolla/passwords.yml passwords.yml.old\ncp kolla-ansible/etc/kolla/passwords.yml passwords.yml.new\nkolla-genpwd -p passwords.yml.new\nkolla-mergepwd --old passwords.yml.old --new passwords.yml.new --final /etc/kolla/passwords.yml\n\nansible-vault encrypt /etc/kolla/passwords.yml\n")),(0,l.kt)("p",null,"\u5728\u66f4\u65b0\u4e4b\u524d\u5efa\u8b70\u5148\u628a\u65b0\u7248\u672c\u7684 image \u5148 pull \u4e0b\u4f86\u4ee5\u6e1b\u5c11\u5be6\u969b\u8dd1 Ansible \u66f4\u65b0\u7684\u6642\u9593\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kolla-ansible -i /etc/kolla/multinode pull --ask-vault-pass -v\n")),(0,l.kt)("p",null,"\u6700\u5f8c\u8dd1\u6aa2\u67e5\u8a2d\u5b9a\u548c\u66f4\u65b0\u7684\u6307\u4ee4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kolla-ansible -i /etc/kolla/multinode prechecks --ask-vault-pass -v\nkolla-ansible -i /etc/kolla/multinode upgrade --ask-vault-pass -v\n")),(0,l.kt)("h2",{id:"adding-and-removing-hosts"},"\u65b0\u589e/\u79fb\u9664\u7bc0\u9ede"),(0,l.kt)("p",null,"\u65b0\u589e\u79fb\u9664\u7bc0\u9ede\u8acb\u53c3\u8003",(0,l.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/adding-and-removing-hosts.html"},"\u5b98\u65b9\u6587\u4ef6")))}u.isMDXComponent=!0}}]);